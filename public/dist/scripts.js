"use strict";$(function(){var e=null;function s(){0===$("li.trackList.highlight").prev().length?$("#trackPrev").addClass("inactive"):$("#trackPrev").removeClass("inactive"),0===$("li.trackList.highlight").next().length?$("#trackNext").addClass("inactive"):$("#trackNext").removeClass("inactive"),0===$("li.trackList.highlight").prev().length&&0===$("li.trackList.highlight").next().length&&$("#trackShuffle").addClass("inactive")}$(document).foundation(),$(".screenText").slick({dots:!0,infinite:!0,speed:500,fade:!0,cssEase:"linear"}),window.location.pathname.indexOf("play")&&$("#audioPlayer").mediaelementplayer({stretching:"responsive",pluginPath:"../js/lib/build/",success:function(a,t,r){e=a,s(),$(a).on("ended",function(){if($("#trackShuffle").hasClass("active")){var t=$("li.trackList").length,r=Math.floor(Math.random()*t+1);(n=$("li.trackList:nth-child("+r+")")).hasClass("highlight")&&0===(n=n.next()).length&&(n=$("li.trackList:nth-child(1)")),n.click(),s()}else{var n=$("li.trackList.highlight").next();$("#trackRepeat").hasClass("active")?a.play():0===n.length?function(s){$(".trackList").removeClass("highlight"),$(".trackItem").removeClass("fi-sound"),s.addClass("highlight"),s.find(".trackItem").addClass("fi-sound");var a=s.data("track-src");e.setSrc(a),e.load()}($("li.trackList").first()):n.click(),s()}})},error:function(e,s){alert("There is some error at the server playing the track!")}}),$(window).on("load resize",function(){$("#footer");$(".title-bar").is(":visible")?$("#index-menu").removeClass("addFloat"):$("#index-menu").addClass("addFloat");$(window).width()<400?($(".menuDiv").addClass("menuMode"),$("#user-menu").addClass("menuMod"),$("#user-menu").removeClass("show")):($("#user-menu").removeClass("show"),$("#user-menu").css("width","180px"),$(".close-icon").remove(),$(".menuDiv").removeClass("menuMode"),$("#user-menu").removeClass("menuMod"))}),$("#login").on("submit",function(e){e.preventDefault(),l();var s=$("#userName").val(),a=$("#userPassword").val();if(0!==s.length&&0!==a.length){var t=/^[a-zA-Z0-9._]{1,30}$/.test(s);t?$.post("/login",{username:s,password:a}).fail(function(e){var s=e.responseJSON;400===e.status&&c(s[0].msg,"error"),401===e.status&&c(s.msg,"error")}).done(function(e){window.location.href="/user/home"}):(d("userName"),c("Usernames can only use letters, numbers, underscores and periods.","error"))}else 0===s.length&&(d("userName"),$("#emptyFields").removeClass("hide")),0==a.length&&(d("userPassword"),$("#emptyFields").removeClass("hide"))}),$("#editProfile").on("submit",function(e){e.preventDefault(),l();var s=$("#userName").val(),a=$("#email").val();if(0!==s.length&&0!==a.length){var t=/^[a-zA-Z0-9._]{1,30}$/.test(s);t?$.post("/user/editProfile",{username:s,email:a}).fail(function(e){if(400===e.status){var s=e.responseJSON;s.length>=1?c(s[0].msg,"error"):c(s.msg,"error")}}).done(function(e){c(e.msg,"msg"),$("#loginLink").removeClass("hide"),$(".btns").addClass("hide")}):(d("userName"),c("Usernames can only use letters, numbers, underscores and periods.","error"))}else 0===s.length&&(d("userName"),$("#emptyFields").removeClass("hide")),0==a.length&&(d("email"),$("#emptyFields").removeClass("hide"))}),$("#confirmUser").on("submit",function(e){e.preventDefault(),l();var s=$("#username").val();0!==s.length?$.post("/verifyUser",{username:s}).fail(function(e){if(401===e.status){var s=e.responseJSON;c(s.msg,"error")}}).done(function(e){$("#username").val(""),$("#forgotPassword").removeClass("hide"),$("#confirmUser").addClass("hide"),a=e}):0===s.length&&(d("username"),$("#emptyFields").removeClass("hide"))}),$("#forgotPassword").on("submit",function(e){e.preventDefault(),l();var s=$("#newPassword").val(),t=$("#confirmPassword").val();0===s.length&&(d("newPassword"),$("#emptyFields").removeClass("hide"));0===t.length&&(d("confirmPassword"),$("#emptyFields").removeClass("hide"));0!==s.length&&t!==s&&(d("confirmPassword"),$("#emptyFields").addClass("hide"),c("Confirm password doesn't match with the new password","error"));0!==s.length&&0!==t.length&&s===t&&$.post("/forgotPassword",{newPassword:s,user:a}).fail(function(e){if(400===e.status){var s=e.responseJSON;c(s.msg,"error")}}).done(function(e){c(e.msg,"msg"),$(".btns").addClass("hide"),$("#loginLink").removeClass("hide")})}),$("#signup").on("submit",function(e){e.preventDefault(),l();var s=$("#userName").val(),a=$("#userEmail").val(),t=$("#userPassword").val(),r=$("#confirmPassword").val(),n=/^[a-zA-Z0-9._]{1,30}$/.test(s);0===s.length&&(d("userName"),$("#emptyFields").removeClass("hide"));n||0===s.length||(d("userName"),c("Usernames can only use letters, numbers, underscores and periods.","error"));0===a.length&&(d("userEmail"),$("#emptyFields").removeClass("hide"));0===t.length&&(d("userPassword"),$("#emptyFields").removeClass("hide"));0===r.length&&(d("confirmPassword"),$("#emptyFields").removeClass("hide"));0!==t.length&&0!==r.length&&r!==t&&(d("confirmPassword"),$("#emptyFields").addClass("hide"),c("Confirm password doesn't match with password","error"),0!==a.length&&0!==s.length||$("#emptyFields").removeClass("hide"));0!==s.length&&0!==t.length&&0!==r.length&&0!==a.length&&t===r&&n&&$.post("/signup",{username:s,password:t,email:a}).fail(function(e){if(400===e.status){var s=e.responseJSON;s.length>=1?c(s[0].msg,"error"):c(s.msg,"error")}}).done(function(e){c(e.msg,"msg"),$(".btns").addClass("hide"),$("#loginLink").removeClass("hide")})}),$("#reset").on("click",l),$("#changePassword").on("submit",function(e){e.preventDefault(),l();var s=$("#oldPassword").val(),a=$("#newPassword").val(),t=$("#confirmPassword").val();0===s.length&&(d("oldPassword"),$("#emptyFields").removeClass("hide"));0===a.length&&(d("newPassword"),$("#emptyFields").removeClass("hide"));0===t.length&&(d("confirmPassword"),$("#emptyFields").removeClass("hide"));0!==a.length&&0!==t.length&&t!==a&&(d("confirmPassword"),$("#emptyFields").addClass("hide"),c("Confirm password doesn't match with the new password","error"),0===s.length&&$("#emptyFields").removeClass("hide"));0!==s.length&&0!==a.length&&0!==t.length&&a===t&&$.post("/user/changePassword",{oldPassword:s,newPassword:a}).fail(function(e){if(400===e.status){var s=e.responseJSON;c(s.msg,"error")}}).done(function(e){c(e.msg,"msg"),$(".btns").addClass("hide"),$("#loginLink").removeClass("hide")})}),$("#searchIcon").on("click",t),$(".js-search-close").on("click",function(e){e.preventDefault(),$("#search-text").val(""),$("#headerDiv").removeClass("hide").addClass("show"),$("#search").removeClass("show"),$(".js-nonSearchView").removeClass("hide"),$(".js-searchView").addClass("hide"),-1===window.location.pathname.indexOf("user")&&(window.location.pathname="/user/home")}),$(".menuDiv").on("click",function(e){e.preventDefault(),$("#user-menu").hasClass("show")?$("#user-menu").removeClass("show"):$("#user-menu").addClass("show")}),$(".trackList").on("click",function(s){if(!$(this).hasClass("highlight")){$(".trackList").removeClass("highlight"),$(".trackItem").removeClass("fi-sound"),$(this).addClass("highlight"),$(this).find(".trackItem").addClass("fi-sound");var a=$(this).data("track-src");e.setSrc(a),e.load(),e.play()}}),$("#search-text").on("keyup",function(e){13===e.keyCode&&r(e)}),$(".js-search-icon").on("click",r),$("#trackRepeat").on("click",o),$("#trackLike").on("click",o),$("#trackPrev").on("click",function(e){e.preventDefault(),$(this).hasClass("inactive")||($("li.trackList.highlight").prev().click(),s())}),$("#trackNext").on("click",function(e){e.preventDefault(),$(this).hasClass("inactive")||($("li.trackList.highlight").next().click(),s())}),$("#trackShuffle").on("click",function(e){e.preventDefault(),$(this).hasClass("inactive")||$(this).toggleClass("active")}),$(".playListCreate").on("click",function(e){e.preventDefault()}),$(document).on("click",".menuMode",function(e){e.preventDefault();var s=$("#user-menu");$("#user-menu").addClass("show"),s.css("width","250px"),s.prepend('<div class="close-icon"><i class="fi-x"></i></div>')}),$(document).on("click",".close-icon",function(e){e.preventDefault();var s=$("#user-menu");$("#user-menu").removeClass("show"),s.css("width","180px"),$(".close-icon").remove()}),$(document).on("click",".seeAllR",i);var a=null;function t(e){e&&e.preventDefault(),$("#headerDiv").removeClass("show").addClass("hide"),$("#search").addClass("show"),$(".js-nonSearchView").addClass("hide"),$(".js-searchView").removeClass("hide")}function r(e,s,a){null!==e&&e.preventDefault(),$(".js-searchView").empty();var t=void 0!==s?s:$.trim($("#search-text").val());(t=t.replace(/\s+/g," ")).length>0&&" "!==t&&$.post("/search/"+t).fail(function(e){console.log(e),$("#searchCont").html(e)}).done(function(e){if($("#searchCont").html(e),$("#js-searchResults").removeClass("hide"),void 0===a){var s="/search/"+t;history.pushState({search:t},"",s)}})}if(console.log(window.history.state),console.log(window.history),null!==window.history.state){var n=window.history.state;void 0!==n.search&&void 0===n.category?(t(),$("#search-text").val(n.search),r(null,n.search,"noPopstate")):void 0!==n.search&&void 0!==n.category&&(t(),$("#search-text").val(n.search),i(null,n.search,n.category,"noPopstate"))}function i(e,s,a,t){null!==e&&e.preventDefault();var r=void 0!==s?s:$(".searchStr").html(),n=void 0!==a?a:$(this).data("category");$.post("/search/"+n+"/"+r).fail(function(e){$("#searchCont").html(e)}).done(function(e){if($("#searchCont").html(e),$("#js-searchResults").removeClass("hide"),void 0===t){var s="/search/"+n+"/"+r;history.pushState({search:r,category:n},"",s)}})}function o(e){e.preventDefault(),$(this).toggleClass("active")}function l(){$("#error").empty(),$("#msg").empty(),$("#emptyFields").addClass("hide"),$(".icon-error").remove()}function c(e,s){var a=$("#msgcont");0===a.length&&(a=$("<ul id='msgcont'></ul>")),a.append("<li>"+e+"</li>"),$("#"+s).html(a)}function d(e){var s=$("#"+e),a=$("<span class='icon-error'><i class='fi-x-circle'></i></span>");s.after(a)}$(window).on("popstate",function(e){console.log(e);var s=e.originalEvent.state;if(null===s){var a=window.location.href;window.location.href=a}else void 0!==s.search&&void 0===s.category?(t(e),$("#search-text").val(s.search),r(e,s.search,"noPopstate")):void 0!==s.search&&void 0!==s.category&&(t(e),$("#search-text").val(s.search),i(e,s.search,s.category,"noPopstate"))})}());
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiJCIsIm1lZGlhRWxlIiwiaGlnaExpZ2h0UHJldk5leHQiLCJwcmV2IiwibGVuZ3RoIiwiYWRkQ2xhc3MiLCJyZW1vdmVDbGFzcyIsIm5leHQiLCJkb2N1bWVudCIsImZvdW5kYXRpb24iLCJzbGljayIsImRvdHMiLCJpbmZpbml0ZSIsInNwZWVkIiwid2luZG93IiwibG9jYXRpb24iLCJwYXRobmFtZSIsImluZGV4T2YiLCJtZWRpYWVsZW1lbnRwbGF5ZXIiLCJwbHVnaW5QYXRoIiwic3VjY2VzcyIsIm1lZGlhRWxlbWVudCIsIm9yaWdpbmFsTm9kZSIsImluc3RhbmNlIiwib24iLCJoYXNDbGFzcyIsInJhbmRvbSIsIk1hdGgiLCJmbG9vciIsImxpQ291bnQiLCJsaUVsZSIsImNsaWNrIiwicGxheSIsImZpbmQiLCJ0cmFja1NyYyIsImRhdGEiLCJzZXRTcmMiLCJsb2FkIiwiY2FsbEZvY3VzIiwiZmlyc3QiLCJlcnJvciIsImFsZXJ0IiwiaXMiLCJ3aWR0aCIsImNsZWFyTWVzc2FnZSIsImUiLCJwcmV2ZW50RGVmYXVsdCIsIm5hbWUiLCJ2YWwiLCJuYW1lVmVyaWZpZXMiLCJ1c2VyTmFtZVJlZ2V4IiwidGVzdCIsInVzZXJuYW1lIiwicGFzc3dvcmQiLCJmYWlsIiwicmVzcG9uc2VUZXh0Iiwic2hvd01lc3NhZ2UiLCJyZXNwb25zZUpTT04iLCJzdGF0dXMiLCJtc2ciLCJocmVmIiwic2hvd0Vycm9yQ2lyY2xlIiwicHdkIiwiaGFuZGxlVXBkYXRlUHJvZmlsZSIsInBhdHRlcm4iLCJlbWFpbCIsInBvc3QiLCJ1c2VyIiwiZG9uZSIsImhhbmRsZVVwZGF0ZVBhc3N3b3JkIiwibmV3UHdkIiwiY29uZmlybVB3ZCIsIm5ld1Bhc3N3b3JkIiwiaGFuZGxlQ2hhbmdlUGFzc3dvcmQiLCJvbGRQd2QiLCJjb25maXJtcHdkIiwiZGlzcGxheVNlYXJjaEJhciIsIm9sZFBhc3N3b3JkIiwic2hvd1VzZXJNZW51IiwidXNlckljb24iLCJoaWRlVXNlck1lbnUiLCJ0aGlzIiwic2VhcmNoIiwic2VhcmNoU3RyaW5nIiwia2V5Q29kZSIsImxpbmtBY3RpdmUiLCJ0b2dnbGVDbGFzcyIsImNzcyIsInJlbW92ZSIsInNlZUFsbFJlc3VsdHMiLCJzaG93VXNlck1lbnVEIiwic3RyIiwicG9wc3RhdGUiLCJjb25zb2xlIiwiaGlzdG9yeSIsInN0YXRlIiwidW5kZWZpbmVkIiwiY2F0ZWdvcnkiLCJ0cmltIiwiaHRtbCIsInB1c2hTdGF0ZSIsInBhdGgiLCJsb2ciLCJzcmNoU3RyIiwiY2F0ZWdyeSIsInNlYXJjaFN0ciIsInVsRWxlIiwiaW5wRWxlIiwiZW1wdHkiLCJtc2dUeHQiLCJtc2dEaXYiLCJhcHBlbmQiLCJjaXJjbGVJbnAiLCJzcGFuRWxlIiwiYWZ0ZXIiLCJvcmlnaW5hbEV2ZW50Il0sIm1hcHBpbmdzIjoiYUFBQUEsRUFBRSxXQUFBLElBQUFDLEVBQVcsS0FpR1gsU0FBU0MsSUFDMkMsSUFBOUNGLEVBQUUsMEJBQTBCRyxPQUFPQyxPQUNyQ0osRUFBRSxjQUFjSyxTQUFTLFlBRXpCTCxFQUFFLGNBQWNNLFlBQVksWUFFb0IsSUFBOUNOLEVBQUUsMEJBQTBCTyxPQUFPSCxPQUNyQ0osRUFBRSxjQUFjSyxTQUFTLFlBRXpCTCxFQUFFLGNBQWNNLFlBQVksWUFHb0IsSUFBOUNOLEVBQUUsMEJBQTBCRyxPQUFPQyxRQUE4RCxJQUE5Q0osRUFBRSwwQkFBMEJPLE9BQU9ILFFBQ3hGSixFQUFFLGlCQUFpQkssU0FBUyxZQXZHaENMLEVBQUVRLFVBQVVDLGFBS1pULEVBQUUsZUFBZVUsT0FDZkMsTUFBTSxFQUROQyxVQUFBLEVBQ0FELE1BQU0sSUFDTkMsTUFBQUEsRUFDQUMsUUFBTyxXQVFMQyxPQUFPQyxTQUFTQyxTQUFTQyxRQUFRLFNBQ25DakIsRUFBRSxnQkFBZ0JrQixvQkFEaEJKLFdBQU9DLGFBQ1BJLFdBQUEsbUJBR0FDLFFBQUEsU0FBQUMsRUFBQUMsRUFBQUMsR0FDQXRCLEVBQUFvQixFQUNBRCxJQUtFcEIsRUFBRXFC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VWYsTUF2QmQsU0FBU04sRUFBV3hDLEdBNkJwQkEsRUFBQUMsaUJBQ0U5QyxFQUFBaUYsTUFBTTBCLFlBQVcsVUFqQm5CLFNBQVMvRCxJQUNQNUMsRUFBRSxVQUFVNEcsUUFDWjVHLEVBQUUsUUFBUTRHLFFBQ1Y1RyxFQUFFLGdCQUFnQkssU0FBUyxRQUMzQkwsRUFBRSxlQUFld0YsU0FHbkIsU0FBU2hDLEVBQVlxRCxFQUFRQyxHQUMzQixJQUFJSixFQUFRMUcsRUFBRSxZQUNPLElBQWpCMEcsRUFBTXRHLFNBQ1JzRyxFQUFRMUcsRUFBRSwyQkFFWjBHLEVBQU1LLE9BQU8sT0FBU0YsRUFBUyxTQUMvQjdHLEVBQUUsSUFBTThHLEdBQVFYLEtBQUtPLEdBR3ZCLFNBQVM3QyxFQUFnQm1ELEdBQ3ZCLElBQU1MLEVBQVMzRyxFQUFFLElBQU1nSCxHQUNqQkMsRUFBVWpILEVBQUUsK0RBQ2xCMkcsRUFBT08sTUFBTUQsR0FqRGJqSCxFQUFBQSxRQUFBd0IsR0FBQSxXQUFrQnlFLFNBQWxCcEQsR0FFSTdDLFFBQUVzRyxJQUFBekQsR0FDSCxJQUNBdUIsRUFBS3ZCLEVBQUFzRSxjQUFlcEIsTUFFbkIvRixHQUFFLE9BQUErRixFQUFBLENBQ0YsSUFBSUgsRUFBQUEsT0FBYUksU0FBV3BDLEtBQzFCOUMsT0FBTTZFLFNBQUFBLEtBQUFBLFlBQ1lLLElBQWxCRixFQUFRTSxhQUFVSixJQUFBRCxFQUFBRSxVQUNoQmYsRUFBUXVCLEdBQ1JSLEVBQUFBLGdCQUFVQSxJQUFBQSxFQUFBQSxRQUZNZixFQUFsQnJDLEVBR084QyxFQUhQVCxPQUFBLG9CQUlEYyxJQUFBRCxFQUFBYixhQUFBYyxJQUFBRCxFQUFBRSxXQWJMckIsRUFBQS9CLEdBZUQ3QyxFQUFBLGdCQUFBZ0QsSUFBQStDLEVBQUFiLFFBM0JHTyxFQUFjNUMsRUFBR2tELEVBQU1iLE9BQVFhLEVBQU1FLFNBQVUsaUJBNW9CbkQiLCJmaWxlIjoic2NyaXB0cy5qcyIsInNvdXJjZXNDb250ZW50IjpbIiQoZnVuY3Rpb24oKSB7XG5cbiAgdmFyIG1lZGlhRWxlID0gbnVsbDtcblxuICAvKipcbiAgICogSW5pdGlhbGl6ZSBmb3VuZGF0aW9uXG4gICAqL1xuICAkKGRvY3VtZW50KS5mb3VuZGF0aW9uKCk7XG5cbiAgLyoqXG4gICAqIEluaXRpYWxpemUgc2xpZGVyXG4gICAqL1xuICAkKCcuc2NyZWVuVGV4dCcpLnNsaWNrKHtcbiAgICBkb3RzOiB0cnVlLFxuICAgIGluZmluaXRlOiB0cnVlLFxuICAgIHNwZWVkOiA1MDAsXG4gICAgZmFkZTogdHJ1ZSxcbiAgICBjc3NFYXNlOiAnbGluZWFyJ1xuICB9KTtcblxuICAvKipcbiAgICogSW5pdGlhbGl6ZSBhdWRpbyBwbGF5ZXJcbiAgICovXG4gIGlmICh3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUuaW5kZXhPZigncGxheScpKSB7XG4gICAgJCgnI2F1ZGlvUGxheWVyJykubWVkaWFlbGVtZW50cGxheWVyKHtcbiAgICAgIHN0cmV0Y2hpbmc6ICdyZXNwb25zaXZlJyxcbiAgICAgIHBsdWdpblBhdGg6ICcuLi9qcy9saWIvYnVpbGQvJyxcbiAgICAgIC8vIFdoZW4gdXNpbmcgalF1ZXJ5J3MgYG1lZGlhZWxlbWVudHBsYXllcmAsIGFuIGBpbnN0YW5jZWAgYXJndW1lbnRcbiAgICAgIC8vIGlzIGF2YWlsYWJsZSBpbiB0aGUgYHN1Y2Nlc3NgIGNhbGxiYWNrXG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbihtZWRpYUVsZW1lbnQsIG9yaWdpbmFsTm9kZSwgaW5zdGFuY2UpIHtcbiAgICAgICAgbWVkaWFFbGUgPSBtZWRpYUVsZW1lbnQ7XG4gICAgICAgIGhpZ2hMaWdodFByZXZOZXh0KCk7XG5cbiAgICAgICAgLy9tZWRpYUVsZS5wbGF5KCk7XG4gICAgICAgICQobWVkaWFFbGVtZW50KS5vbignZW5kZWQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZiAoJCgnI3RyYWNrU2h1ZmZsZScpLmhhc0NsYXNzKCdhY3RpdmUnKSkge1xuICAgICAgICAgICAgY29uc3QgbGlDb3VudCA9ICQoJ2xpLnRyYWNrTGlzdCcpLmxlbmd0aDtcbiAgICAgICAgICAgIGNvbnN0IHJhbmRvbSA9IE1hdGguZmxvb3IoKE1hdGgucmFuZG9tKCkgKiBsaUNvdW50KSArIDEpO1xuICAgICAgICAgICAgdmFyIGxpRWxlID0gJCgnbGkudHJhY2tMaXN0Om50aC1jaGlsZCgnICsgcmFuZG9tICsgJyknKTtcblxuXG4gICAgICAgICAgICBpZiAobGlFbGUuaGFzQ2xhc3MoJ2hpZ2hsaWdodCcpKSB7XG4gICAgICAgICAgICAgIGxpRWxlID0gbGlFbGUubmV4dCgpO1xuICAgICAgICAgICAgICBpZiAobGlFbGUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgbGlFbGUgPSAkKCdsaS50cmFja0xpc3Q6bnRoLWNoaWxkKDEpJyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbGlFbGUuY2xpY2soKTtcbiAgICAgICAgICAgIGhpZ2hMaWdodFByZXZOZXh0KCk7XG5cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIGxpRWxlID0gJCgnbGkudHJhY2tMaXN0LmhpZ2hsaWdodCcpLm5leHQoKTtcbiAgICAgICAgICAgIGlmICgkKCcjdHJhY2tSZXBlYXQnKS5oYXNDbGFzcygnYWN0aXZlJykpIHtcbiAgICAgICAgICAgICAgbWVkaWFFbGVtZW50LnBsYXkoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGlmIChsaUVsZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBjYWxsRm9jdXMoJCgnbGkudHJhY2tMaXN0JykuZmlyc3QoKSk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbGlFbGUuY2xpY2soKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaGlnaExpZ2h0UHJldk5leHQoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICAgIGVycm9yOiBmdW5jdGlvbihtZWRpYUVsZW1lbnQsIG9yaWdpbmFsTm9kZSkge1xuICAgICAgICBhbGVydCgnVGhlcmUgaXMgc29tZSBlcnJvciBhdCB0aGUgc2VydmVyIHBsYXlpbmcgdGhlIHRyYWNrIScpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gc2h1ZmZsZVRyYWNrcyhlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGlmICghJCh0aGlzKS5oYXNDbGFzcygnaW5hY3RpdmUnKSkge1xuICAgICAgJCh0aGlzKS50b2dnbGVDbGFzcygnYWN0aXZlJyk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcGxheVByZXZpb3VzKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgaWYgKCEkKHRoaXMpLmhhc0NsYXNzKCdpbmFjdGl2ZScpKSB7XG4gICAgICB2YXIgbGlFbGUgPSAkKCdsaS50cmFja0xpc3QuaGlnaGxpZ2h0JykucHJldigpO1xuICAgICAgbGlFbGUuY2xpY2soKTtcbiAgICAgIGhpZ2hMaWdodFByZXZOZXh0KCk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcGxheU5leHQoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBpZiAoISQodGhpcykuaGFzQ2xhc3MoJ2luYWN0aXZlJykpIHtcbiAgICAgIHZhciBsaUVsZSA9ICQoJ2xpLnRyYWNrTGlzdC5oaWdobGlnaHQnKS5uZXh0KCk7XG4gICAgICBsaUVsZS5jbGljaygpO1xuICAgICAgaGlnaExpZ2h0UHJldk5leHQoKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBoaWdoTGlnaHRQcmV2TmV4dCgpIHtcbiAgICBpZiAoJCgnbGkudHJhY2tMaXN0LmhpZ2hsaWdodCcpLnByZXYoKS5sZW5ndGggPT09IDApIHtcbiAgICAgICQoJyN0cmFja1ByZXYnKS5hZGRDbGFzcygnaW5hY3RpdmUnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgJCgnI3RyYWNrUHJldicpLnJlbW92ZUNsYXNzKCdpbmFjdGl2ZScpO1xuICAgIH1cbiAgICBpZiAoJCgnbGkudHJhY2tMaXN0LmhpZ2hsaWdodCcpLm5leHQoKS5sZW5ndGggPT09IDApIHtcbiAgICAgICQoJyN0cmFja05leHQnKS5hZGRDbGFzcygnaW5hY3RpdmUnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgJCgnI3RyYWNrTmV4dCcpLnJlbW92ZUNsYXNzKCdpbmFjdGl2ZScpO1xuICAgIH1cblxuICAgIGlmICgkKCdsaS50cmFja0xpc3QuaGlnaGxpZ2h0JykucHJldigpLmxlbmd0aCA9PT0gMCAmJiAkKCdsaS50cmFja0xpc3QuaGlnaGxpZ2h0JykubmV4dCgpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgJCgnI3RyYWNrU2h1ZmZsZScpLmFkZENsYXNzKCdpbmFjdGl2ZScpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGNhbGxGb2N1cyhsaUVsZSkge1xuICAgICQoJy50cmFja0xpc3QnKS5yZW1vdmVDbGFzcygnaGlnaGxpZ2h0Jyk7XG4gICAgJCgnLnRyYWNrSXRlbScpLnJlbW92ZUNsYXNzKCdmaS1zb3VuZCcpO1xuICAgIGxpRWxlLmFkZENsYXNzKCdoaWdobGlnaHQnKTtcbiAgICBsaUVsZS5maW5kKCcudHJhY2tJdGVtJykuYWRkQ2xhc3MoJ2ZpLXNvdW5kJyk7XG4gICAgY29uc3QgdHJhY2tTcmMgPSBsaUVsZS5kYXRhKCd0cmFjay1zcmMnKTtcbiAgICAvLyBjb25zdCBzdHIgPSB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWU7XG4gICAgLy8gY29uc3QgcGF0aCA9IHN0ci5zdWJzdHIoMCwgc3RyLmxhc3RJbmRleE9mKFwiL1wiKSArIDEpO1xuICAgIC8vIGNvbnN0IHRyYWNrSWQgPSBsaUVsZS5hdHRyKCdpZCcpO1xuICAgIG1lZGlhRWxlLnNldFNyYyh0cmFja1NyYyk7XG4gICAgbWVkaWFFbGUubG9hZCgpO1xuICAgIC8vaGlzdG9yeS5wdXNoU3RhdGUodHJhY2tJZCwgJycsIHBhdGggKyB0cmFja0lkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWdpc3RlciBmdW5jdGlvbnNcbiAgICovXG4gICQod2luZG93KS5vbignbG9hZCByZXNpemUnLCBoYW5kbGVMb2FkKTtcbiAgJCgnI2xvZ2luJykub24oJ3N1Ym1pdCcsIGhhbmRsZUxvZ2luKTsgLyogb24gbG9naW4gKi9cbiAgJCgnI2VkaXRQcm9maWxlJykub24oJ3N1Ym1pdCcsIGhhbmRsZVVwZGF0ZVByb2ZpbGUpOyAvKiB1cGRhdGUgcHJvZmlsZSAqL1xuICAkKCcjY29uZmlybVVzZXInKS5vbignc3VibWl0JywgaGFuZGxlVmVyaWZ5VXNlcik7IC8qIHZlcmlmeSB1c2VyICovXG4gICQoJyNmb3Jnb3RQYXNzd29yZCcpLm9uKCdzdWJtaXQnLCBoYW5kbGVVcGRhdGVQYXNzd29yZCk7IC8qIHBvc3QgdXBkYXRlIHBhc3N3b3JkICovXG4gICQoJyNzaWdudXAnKS5vbignc3VibWl0JywgaGFuZGxlU2lnblVwKTsgLyogU2lnbiB1cCAqL1xuICAkKCcjcmVzZXQnKS5vbignY2xpY2snLCBjbGVhck1lc3NhZ2UpOyAvKiBDbGVhciBtZXNzYWdlcyBvbiBjbGljayBvZiByZXNldCAqL1xuICAkKCcjY2hhbmdlUGFzc3dvcmQnKS5vbignc3VibWl0JywgaGFuZGxlQ2hhbmdlUGFzc3dvcmQpOyAvKiBwb3N0IGNoYW5nZSBwYXNzd29yZCAqL1xuICAkKCcjc2VhcmNoSWNvbicpLm9uKCdjbGljaycsIGRpc3BsYXlTZWFyY2hCYXIpO1xuICAkKCcuanMtc2VhcmNoLWNsb3NlJykub24oJ2NsaWNrJywgaGlkZVNlYXJjaEJhcik7XG4gICQoJy5tZW51RGl2Jykub24oJ2NsaWNrJywgc2hvd1VzZXJNZW51RCk7XG4gICQoJy50cmFja0xpc3QnKS5vbignY2xpY2snLCBjaGFuZ2VUcmFjayk7IC8qIGNoYW5nZSB0cmFjayBvbiBjbGljayAqL1xuICAkKCcjc2VhcmNoLXRleHQnKS5vbigna2V5dXAnLCBjYWxsU2VhcmNoKTsgLyogc2VhcmNoIGZ1bmN0aW9uYWxpdHkgKi9cbiAgJCgnLmpzLXNlYXJjaC1pY29uJykub24oJ2NsaWNrJywgc2VhcmNoKTsgLyogc2VhcmNoIGZ1bmN0aW9uYWxpdHkgKi9cbiAgJCgnI3RyYWNrUmVwZWF0Jykub24oJ2NsaWNrJywgbGlua0FjdGl2ZSk7XG4gICQoJyN0cmFja0xpa2UnKS5vbignY2xpY2snLCBsaW5rQWN0aXZlKTtcbiAgJCgnI3RyYWNrUHJldicpLm9uKCdjbGljaycsIHBsYXlQcmV2aW91cyk7IC8qIHBsYXkgcHJldmlvdXMgdHJhY2sgKi9cbiAgJCgnI3RyYWNrTmV4dCcpLm9uKCdjbGljaycsIHBsYXlOZXh0KTsgLyogcGxheSBuZXh0IHRyYWNrICovXG4gICQoJyN0cmFja1NodWZmbGUnKS5vbignY2xpY2snLCBzaHVmZmxlVHJhY2tzKTsgLyogc2h1ZmZsZSB0cmFja3MqL1xuICAkKCcucGxheUxpc3RDcmVhdGUnKS5vbignY2xpY2snLCBjcmVhdGVQbGF5bGlzdCk7IC8qIENyZWF0ZSBwbGF5bGlzdCAqL1xuICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLm1lbnVNb2RlJywgc2hvd1VzZXJNZW51KTtcbiAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5jbG9zZS1pY29uJywgaGlkZVVzZXJNZW51KTtcbiAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5zZWVBbGxSJywgc2VlQWxsUmVzdWx0cyk7IC8qIHNlZSBhbGwgdGhlIHRyYWNrcyBvZiBzZWFyY2ggcmVzdWx0cyAqL1xuXG5cbiAgdmFyIHVzZXIgPSBudWxsO1xuXG5cbiAgLyogZnVuY3Rpb25zICovXG4gIGZ1bmN0aW9uIGhhbmRsZUxvYWQoKSB7XG4gICAgY29uc3QgZm9vdGVyID0gJCgnI2Zvb3RlcicpO1xuICAgIGlmICgkKCcudGl0bGUtYmFyJykuaXMoJzp2aXNpYmxlJykpIHtcbiAgICAgICQoJyNpbmRleC1tZW51JykucmVtb3ZlQ2xhc3MoJ2FkZEZsb2F0Jyk7XG4gICAgfSBlbHNlIHtcbiAgICAgICQoJyNpbmRleC1tZW51JykuYWRkQ2xhc3MoJ2FkZEZsb2F0Jyk7XG4gICAgfVxuICAgIHZhciB3aWR0aCA9ICQod2luZG93KS53aWR0aCgpO1xuICAgIGlmICh3aWR0aCA8IDQwMCkge1xuICAgICAgJCgnLm1lbnVEaXYnKS5hZGRDbGFzcygnbWVudU1vZGUnKTtcbiAgICAgICQoJyN1c2VyLW1lbnUnKS5hZGRDbGFzcygnbWVudU1vZCcpO1xuICAgICAgJCgnI3VzZXItbWVudScpLnJlbW92ZUNsYXNzKCdzaG93Jyk7XG4gICAgfSBlbHNlIHtcbiAgICAgICQoJyN1c2VyLW1lbnUnKS5yZW1vdmVDbGFzcygnc2hvdycpO1xuICAgICAgJCgnI3VzZXItbWVudScpLmNzcygnd2lkdGgnLCAnMTgwcHgnKTtcbiAgICAgICQoJy5jbG9zZS1pY29uJykucmVtb3ZlKCk7XG4gICAgICAkKCcubWVudURpdicpLnJlbW92ZUNsYXNzKCdtZW51TW9kZScpO1xuICAgICAgJCgnI3VzZXItbWVudScpLnJlbW92ZUNsYXNzKCdtZW51TW9kJyk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gaGFuZGxlTG9naW4oZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBjbGVhck1lc3NhZ2UoKTtcbiAgICBjb25zdCBuYW1lID0gJCgnI3VzZXJOYW1lJykudmFsKCk7XG4gICAgY29uc3QgcHdkID0gJCgnI3VzZXJQYXNzd29yZCcpLnZhbCgpO1xuXG4gICAgaWYgKG5hbWUubGVuZ3RoICE9PSAwICYmIHB3ZC5sZW5ndGggIT09IDApIHtcbiAgICAgIGNvbnN0IHVzZXJOYW1lUmVnZXggPSAvXlthLXpBLVowLTkuX117MSwzMH0kLztcbiAgICAgIGNvbnN0IG5hbWVWZXJpZmllcyA9IHVzZXJOYW1lUmVnZXgudGVzdChuYW1lKTtcblxuICAgICAgaWYgKG5hbWVWZXJpZmllcykge1xuICAgICAgICAkLnBvc3QoJy9sb2dpbicsIHtcbiAgICAgICAgICAgIHVzZXJuYW1lOiBuYW1lLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IHB3ZFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZhaWwoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2VUZXh0ID0gZGF0YS5yZXNwb25zZUpTT047XG4gICAgICAgICAgICBpZiAoZGF0YS5zdGF0dXMgPT09IDQwMCkge1xuICAgICAgICAgICAgICBzaG93TWVzc2FnZShyZXNwb25zZVRleHRbMF0ubXNnLCAnZXJyb3InKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChkYXRhLnN0YXR1cyA9PT0gNDAxKSB7XG4gICAgICAgICAgICAgIHNob3dNZXNzYWdlKHJlc3BvbnNlVGV4dC5tc2csICdlcnJvcicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmRvbmUoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSAnL3VzZXIvaG9tZSc7XG4gICAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzaG93RXJyb3JDaXJjbGUoJ3VzZXJOYW1lJyk7XG4gICAgICAgIHNob3dNZXNzYWdlKCdVc2VybmFtZXMgY2FuIG9ubHkgdXNlIGxldHRlcnMsIG51bWJlcnMsIHVuZGVyc2NvcmVzIGFuZCBwZXJpb2RzLicsICdlcnJvcicpO1xuXG4gICAgICB9XG4gICAgfSBlbHNlIHtcblxuICAgICAgaWYgKG5hbWUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHNob3dFcnJvckNpcmNsZSgndXNlck5hbWUnKTtcbiAgICAgICAgJCgnI2VtcHR5RmllbGRzJykucmVtb3ZlQ2xhc3MoJ2hpZGUnKTtcbiAgICAgIH1cbiAgICAgIGlmIChwd2QubGVuZ3RoID09IDApIHtcbiAgICAgICAgc2hvd0Vycm9yQ2lyY2xlKCd1c2VyUGFzc3dvcmQnKTtcbiAgICAgICAgJCgnI2VtcHR5RmllbGRzJykucmVtb3ZlQ2xhc3MoJ2hpZGUnKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBoYW5kbGVVcGRhdGVQcm9maWxlKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICBjbGVhck1lc3NhZ2UoKTtcblxuICAgIGNvbnN0IHVzZXJuYW1lID0gJCgnI3VzZXJOYW1lJykudmFsKCk7XG4gICAgY29uc3QgZW1haWwgPSAkKCcjZW1haWwnKS52YWwoKTtcblxuICAgIGlmICh1c2VybmFtZS5sZW5ndGggIT09IDAgJiYgZW1haWwubGVuZ3RoICE9PSAwKSB7XG5cbiAgICAgIGNvbnN0IHBhdHRlcm4gPSAvXlthLXpBLVowLTkuX117MSwzMH0kLztcbiAgICAgIGNvbnN0IG5hbWVWZXJpZmllcyA9IHBhdHRlcm4udGVzdCh1c2VybmFtZSk7XG4gICAgICBpZiAobmFtZVZlcmlmaWVzKSB7XG4gICAgICAgICQucG9zdCgnL3VzZXIvZWRpdFByb2ZpbGUnLCB7XG4gICAgICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUsXG4gICAgICAgICAgICBlbWFpbDogZW1haWxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5mYWlsKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhLnN0YXR1cyA9PT0gNDAwKSB7XG4gICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlVGV4dCA9IGRhdGEucmVzcG9uc2VKU09OO1xuICAgICAgICAgICAgICBpZiAocmVzcG9uc2VUZXh0Lmxlbmd0aCA+PSAxKSB7XG4gICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UocmVzcG9uc2VUZXh0WzBdLm1zZywgJ2Vycm9yJyk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UocmVzcG9uc2VUZXh0Lm1zZywgJ2Vycm9yJyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICAgIC5kb25lKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgIHNob3dNZXNzYWdlKGRhdGEubXNnLCAnbXNnJyk7XG4gICAgICAgICAgICAkKCcjbG9naW5MaW5rJykucmVtb3ZlQ2xhc3MoJ2hpZGUnKTtcbiAgICAgICAgICAgICQoJy5idG5zJykuYWRkQ2xhc3MoJ2hpZGUnKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNob3dFcnJvckNpcmNsZSgndXNlck5hbWUnKTtcbiAgICAgICAgc2hvd01lc3NhZ2UoJ1VzZXJuYW1lcyBjYW4gb25seSB1c2UgbGV0dGVycywgbnVtYmVycywgdW5kZXJzY29yZXMgYW5kIHBlcmlvZHMuJywgJ2Vycm9yJyk7XG5cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHVzZXJuYW1lLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBzaG93RXJyb3JDaXJjbGUoJ3VzZXJOYW1lJyk7XG4gICAgICAgICQoJyNlbXB0eUZpZWxkcycpLnJlbW92ZUNsYXNzKCdoaWRlJyk7XG4gICAgICB9XG4gICAgICBpZiAoZW1haWwubGVuZ3RoID09IDApIHtcbiAgICAgICAgc2hvd0Vycm9yQ2lyY2xlKCdlbWFpbCcpO1xuICAgICAgICAkKCcjZW1wdHlGaWVsZHMnKS5yZW1vdmVDbGFzcygnaGlkZScpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGhhbmRsZVZlcmlmeVVzZXIoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgIGNsZWFyTWVzc2FnZSgpO1xuXG4gICAgY29uc3QgdXNlcm5hbWUgPSAkKCcjdXNlcm5hbWUnKS52YWwoKTtcblxuICAgIGlmICh1c2VybmFtZS5sZW5ndGggIT09IDApIHtcblxuICAgICAgJC5wb3N0KCcvdmVyaWZ5VXNlcicsIHtcbiAgICAgICAgICB1c2VybmFtZTogdXNlcm5hbWVcbiAgICAgICAgfSlcbiAgICAgICAgLmZhaWwoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgIGlmIChkYXRhLnN0YXR1cyA9PT0gNDAxKSB7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZVRleHQgPSBkYXRhLnJlc3BvbnNlSlNPTjtcbiAgICAgICAgICAgIHNob3dNZXNzYWdlKHJlc3BvbnNlVGV4dC5tc2csICdlcnJvcicpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgLmRvbmUoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICQoJyN1c2VybmFtZScpLnZhbCgnJyk7XG4gICAgICAgICAgJCgnI2ZvcmdvdFBhc3N3b3JkJykucmVtb3ZlQ2xhc3MoJ2hpZGUnKTtcbiAgICAgICAgICAkKCcjY29uZmlybVVzZXInKS5hZGRDbGFzcygnaGlkZScpO1xuICAgICAgICAgIHVzZXIgPSBkYXRhO1xuICAgICAgICB9KTtcblxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAodXNlcm5hbWUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHNob3dFcnJvckNpcmNsZSgndXNlcm5hbWUnKTtcbiAgICAgICAgJCgnI2VtcHR5RmllbGRzJykucmVtb3ZlQ2xhc3MoJ2hpZGUnKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBoYW5kbGVVcGRhdGVQYXNzd29yZChlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGNsZWFyTWVzc2FnZSgpO1xuXG4gICAgY29uc3QgbmV3UHdkID0gJCgnI25ld1Bhc3N3b3JkJykudmFsKCk7XG4gICAgY29uc3QgY29uZmlybVB3ZCA9ICQoJyNjb25maXJtUGFzc3dvcmQnKS52YWwoKTtcblxuICAgIGlmIChuZXdQd2QubGVuZ3RoID09PSAwKSB7XG4gICAgICBzaG93RXJyb3JDaXJjbGUoJ25ld1Bhc3N3b3JkJyk7XG4gICAgICAkKCcjZW1wdHlGaWVsZHMnKS5yZW1vdmVDbGFzcygnaGlkZScpO1xuICAgIH1cblxuICAgIGlmIChjb25maXJtUHdkLmxlbmd0aCA9PT0gMCkge1xuICAgICAgc2hvd0Vycm9yQ2lyY2xlKCdjb25maXJtUGFzc3dvcmQnKTtcbiAgICAgICQoJyNlbXB0eUZpZWxkcycpLnJlbW92ZUNsYXNzKCdoaWRlJyk7XG4gICAgfVxuXG4gICAgaWYgKG5ld1B3ZC5sZW5ndGggIT09IDAgJiYgY29uZmlybVB3ZCAhPT0gbmV3UHdkKSB7XG4gICAgICBzaG93RXJyb3JDaXJjbGUoJ2NvbmZpcm1QYXNzd29yZCcpO1xuICAgICAgJCgnI2VtcHR5RmllbGRzJykuYWRkQ2xhc3MoJ2hpZGUnKTtcbiAgICAgIHNob3dNZXNzYWdlKCdDb25maXJtIHBhc3N3b3JkIGRvZXNuXFwndCBtYXRjaCB3aXRoIHRoZSBuZXcgcGFzc3dvcmQnLCAnZXJyb3InKTtcbiAgICB9XG5cbiAgICBpZiAobmV3UHdkLmxlbmd0aCAhPT0gMCAmJiBjb25maXJtUHdkLmxlbmd0aCAhPT0gMCAmJiBuZXdQd2QgPT09IGNvbmZpcm1Qd2QpIHtcbiAgICAgICQucG9zdCgnL2ZvcmdvdFBhc3N3b3JkJywge1xuICAgICAgICAgIG5ld1Bhc3N3b3JkOiBuZXdQd2QsXG4gICAgICAgICAgdXNlcjogdXNlclxuICAgICAgICB9KVxuICAgICAgICAuZmFpbChmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgaWYgKGRhdGEuc3RhdHVzID09PSA0MDApIHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlVGV4dCA9IGRhdGEucmVzcG9uc2VKU09OO1xuICAgICAgICAgICAgc2hvd01lc3NhZ2UocmVzcG9uc2VUZXh0Lm1zZywgJ2Vycm9yJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICAuZG9uZShmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgc2hvd01lc3NhZ2UoZGF0YS5tc2csICdtc2cnKTtcbiAgICAgICAgICAkKCcuYnRucycpLmFkZENsYXNzKCdoaWRlJyk7XG4gICAgICAgICAgJCgnI2xvZ2luTGluaycpLnJlbW92ZUNsYXNzKCdoaWRlJyk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGhhbmRsZUNoYW5nZVBhc3N3b3JkKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgY2xlYXJNZXNzYWdlKCk7XG5cbiAgICBjb25zdCBvbGRQd2QgPSAkKCcjb2xkUGFzc3dvcmQnKS52YWwoKTtcbiAgICBjb25zdCBuZXdQd2QgPSAkKCcjbmV3UGFzc3dvcmQnKS52YWwoKTtcbiAgICBjb25zdCBjb25maXJtUHdkID0gJCgnI2NvbmZpcm1QYXNzd29yZCcpLnZhbCgpO1xuXG4gICAgaWYgKG9sZFB3ZC5sZW5ndGggPT09IDApIHtcbiAgICAgIHNob3dFcnJvckNpcmNsZSgnb2xkUGFzc3dvcmQnKTtcbiAgICAgICQoJyNlbXB0eUZpZWxkcycpLnJlbW92ZUNsYXNzKCdoaWRlJyk7XG4gICAgfVxuXG4gICAgaWYgKG5ld1B3ZC5sZW5ndGggPT09IDApIHtcbiAgICAgIHNob3dFcnJvckNpcmNsZSgnbmV3UGFzc3dvcmQnKTtcbiAgICAgICQoJyNlbXB0eUZpZWxkcycpLnJlbW92ZUNsYXNzKCdoaWRlJyk7XG4gICAgfVxuXG4gICAgaWYgKGNvbmZpcm1Qd2QubGVuZ3RoID09PSAwKSB7XG4gICAgICBzaG93RXJyb3JDaXJjbGUoJ2NvbmZpcm1QYXNzd29yZCcpO1xuICAgICAgJCgnI2VtcHR5RmllbGRzJykucmVtb3ZlQ2xhc3MoJ2hpZGUnKTtcbiAgICB9XG5cbiAgICBpZiAobmV3UHdkLmxlbmd0aCAhPT0gMCAmJiBjb25maXJtUHdkLmxlbmd0aCAhPT0gMCAmJiBjb25maXJtUHdkICE9PSBuZXdQd2QpIHtcbiAgICAgIHNob3dFcnJvckNpcmNsZSgnY29uZmlybVBhc3N3b3JkJyk7XG4gICAgICAkKCcjZW1wdHlGaWVsZHMnKS5hZGRDbGFzcygnaGlkZScpO1xuICAgICAgc2hvd01lc3NhZ2UoJ0NvbmZpcm0gcGFzc3dvcmQgZG9lc25cXCd0IG1hdGNoIHdpdGggdGhlIG5ldyBwYXNzd29yZCcsICdlcnJvcicpO1xuICAgICAgaWYgKG9sZFB3ZC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgJCgnI2VtcHR5RmllbGRzJykucmVtb3ZlQ2xhc3MoJ2hpZGUnKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAob2xkUHdkLmxlbmd0aCAhPT0gMCAmJiBuZXdQd2QubGVuZ3RoICE9PSAwICYmIGNvbmZpcm1Qd2QubGVuZ3RoICE9PSAwICYmIG5ld1B3ZCA9PT0gY29uZmlybVB3ZCkge1xuICAgICAgJC5wb3N0KCcvdXNlci9jaGFuZ2VQYXNzd29yZCcsIHtcbiAgICAgICAgICBvbGRQYXNzd29yZDogb2xkUHdkLFxuICAgICAgICAgIG5ld1Bhc3N3b3JkOiBuZXdQd2RcbiAgICAgICAgfSlcbiAgICAgICAgLmZhaWwoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgIGlmIChkYXRhLnN0YXR1cyA9PT0gNDAwKSB7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZVRleHQgPSBkYXRhLnJlc3BvbnNlSlNPTjtcbiAgICAgICAgICAgIHNob3dNZXNzYWdlKHJlc3BvbnNlVGV4dC5tc2csICdlcnJvcicpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgLmRvbmUoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgIHNob3dNZXNzYWdlKGRhdGEubXNnLCAnbXNnJyk7XG4gICAgICAgICAgJCgnLmJ0bnMnKS5hZGRDbGFzcygnaGlkZScpO1xuICAgICAgICAgICQoJyNsb2dpbkxpbmsnKS5yZW1vdmVDbGFzcygnaGlkZScpO1xuICAgICAgICB9KTtcbiAgICB9XG5cblxuXG4gIH1cblxuICBmdW5jdGlvbiBoYW5kbGVTaWduVXAoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBjbGVhck1lc3NhZ2UoKTtcblxuICAgIGNvbnN0IG5hbWUgPSAkKFwiI3VzZXJOYW1lXCIpLnZhbCgpO1xuICAgIGNvbnN0IGVtYWlsID0gJChcIiN1c2VyRW1haWxcIikudmFsKCk7XG4gICAgY29uc3QgcHdkID0gJChcIiN1c2VyUGFzc3dvcmRcIikudmFsKCk7XG4gICAgY29uc3QgY29uZmlybXB3ZCA9ICQoXCIjY29uZmlybVBhc3N3b3JkXCIpLnZhbCgpO1xuICAgIGNvbnN0IHVzZXJOYW1lUmVnZXggPSAvXlthLXpBLVowLTkuX117MSwzMH0kLztcbiAgICBjb25zdCBuYW1lVmVyaWZpZXMgPSB1c2VyTmFtZVJlZ2V4LnRlc3QobmFtZSk7XG5cblxuICAgIGlmIChuYW1lLmxlbmd0aCA9PT0gMCkge1xuICAgICAgc2hvd0Vycm9yQ2lyY2xlKCd1c2VyTmFtZScpO1xuICAgICAgJCgnI2VtcHR5RmllbGRzJykucmVtb3ZlQ2xhc3MoJ2hpZGUnKTtcbiAgICB9XG5cbiAgICBpZiAoIW5hbWVWZXJpZmllcyAmJiBuYW1lLmxlbmd0aCAhPT0gMCkge1xuICAgICAgc2hvd0Vycm9yQ2lyY2xlKCd1c2VyTmFtZScpO1xuICAgICAgc2hvd01lc3NhZ2UoJ1VzZXJuYW1lcyBjYW4gb25seSB1c2UgbGV0dGVycywgbnVtYmVycywgdW5kZXJzY29yZXMgYW5kIHBlcmlvZHMuJywgJ2Vycm9yJyk7XG4gICAgfVxuXG4gICAgaWYgKGVtYWlsLmxlbmd0aCA9PT0gMCkge1xuICAgICAgc2hvd0Vycm9yQ2lyY2xlKCd1c2VyRW1haWwnKTtcbiAgICAgICQoJyNlbXB0eUZpZWxkcycpLnJlbW92ZUNsYXNzKCdoaWRlJyk7XG4gICAgfVxuXG4gICAgaWYgKHB3ZC5sZW5ndGggPT09IDApIHtcbiAgICAgIHNob3dFcnJvckNpcmNsZSgndXNlclBhc3N3b3JkJyk7XG4gICAgICAkKCcjZW1wdHlGaWVsZHMnKS5yZW1vdmVDbGFzcygnaGlkZScpO1xuICAgIH1cblxuICAgIGlmIChjb25maXJtcHdkLmxlbmd0aCA9PT0gMCkge1xuICAgICAgc2hvd0Vycm9yQ2lyY2xlKCdjb25maXJtUGFzc3dvcmQnKTtcbiAgICAgICQoJyNlbXB0eUZpZWxkcycpLnJlbW92ZUNsYXNzKCdoaWRlJyk7XG4gICAgfVxuXG4gICAgaWYgKHB3ZC5sZW5ndGggIT09IDAgJiYgY29uZmlybXB3ZC5sZW5ndGggIT09IDAgJiYgY29uZmlybXB3ZCAhPT0gcHdkKSB7XG4gICAgICBzaG93RXJyb3JDaXJjbGUoJ2NvbmZpcm1QYXNzd29yZCcpO1xuICAgICAgJCgnI2VtcHR5RmllbGRzJykuYWRkQ2xhc3MoJ2hpZGUnKTtcbiAgICAgIHNob3dNZXNzYWdlKCdDb25maXJtIHBhc3N3b3JkIGRvZXNuXFwndCBtYXRjaCB3aXRoIHBhc3N3b3JkJywgJ2Vycm9yJyk7XG4gICAgICBpZiAoZW1haWwubGVuZ3RoID09PSAwIHx8IG5hbWUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICQoJyNlbXB0eUZpZWxkcycpLnJlbW92ZUNsYXNzKCdoaWRlJyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gY29uc3QgZXJyb3IgPSAnVXNlcm5hbWVzIGNhbiBvbmx5IHVzZSBsZXR0ZXJzLCBudW1iZXJzLCB1bmRlcnNjb3JlcyBhbmQgcGVyaW9kcy4nO1xuICAgIC8vIGNvbnN0IG5hbWUgPSAnT0xJVkUnO1xuICAgIC8vIGNvbnN0IHB3ZCA9ICdPTElWRSc7XG4gICAgLy8gY29uc3QgZW1haWwgPSAnZ2VldGFAZ21haWwuY29tJztcbiAgICBpZiAobmFtZS5sZW5ndGggIT09IDAgJiYgcHdkLmxlbmd0aCAhPT0gMCAmJiBjb25maXJtcHdkLmxlbmd0aCAhPT0gMCAmJlxuICAgICAgZW1haWwubGVuZ3RoICE9PSAwICYmIHB3ZCA9PT0gY29uZmlybXB3ZCAmJiBuYW1lVmVyaWZpZXMpIHtcbiAgICAgICQucG9zdCgnL3NpZ251cCcsIHtcbiAgICAgICAgICB1c2VybmFtZTogbmFtZSxcbiAgICAgICAgICBwYXNzd29yZDogcHdkLFxuICAgICAgICAgIGVtYWlsOiBlbWFpbFxuICAgICAgICB9KVxuICAgICAgICAuZmFpbChmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgaWYgKGRhdGEuc3RhdHVzID09PSA0MDApIHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlVGV4dCA9IGRhdGEucmVzcG9uc2VKU09OO1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlVGV4dC5sZW5ndGggPj0gMSkge1xuICAgICAgICAgICAgICBzaG93TWVzc2FnZShyZXNwb25zZVRleHRbMF0ubXNnLCAnZXJyb3InKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHNob3dNZXNzYWdlKHJlc3BvbnNlVGV4dC5tc2csICdlcnJvcicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgLmRvbmUoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgIHNob3dNZXNzYWdlKGRhdGEubXNnLCAnbXNnJyk7XG4gICAgICAgICAgJCgnLmJ0bnMnKS5hZGRDbGFzcygnaGlkZScpO1xuICAgICAgICAgICQoJyNsb2dpbkxpbmsnKS5yZW1vdmVDbGFzcygnaGlkZScpO1xuICAgICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBkaXNwbGF5U2VhcmNoQmFyKGUpIHtcbiAgICBpZiAoZSkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH1cblxuICAgICQoJyNoZWFkZXJEaXYnKS5yZW1vdmVDbGFzcygnc2hvdycpLmFkZENsYXNzKCdoaWRlJyk7XG4gICAgJCgnI3NlYXJjaCcpLmFkZENsYXNzKCdzaG93Jyk7XG5cbiAgICAvKiBoaWRlIHJlc3Qgb2YgZGF0YSBmb3Igc2VhcmNoIHZpZXcgKi9cbiAgICAkKCcuanMtbm9uU2VhcmNoVmlldycpLmFkZENsYXNzKCdoaWRlJyk7XG4gICAgJCgnLmpzLXNlYXJjaFZpZXcnKS5yZW1vdmVDbGFzcygnaGlkZScpO1xuICB9XG5cbiAgZnVuY3Rpb24gaGlkZVNlYXJjaEJhcihlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICQoJyNzZWFyY2gtdGV4dCcpLnZhbCgnJyk7XG4gICAgJCgnI2hlYWRlckRpdicpLnJlbW92ZUNsYXNzKCdoaWRlJykuYWRkQ2xhc3MoJ3Nob3cnKTtcbiAgICAkKCcjc2VhcmNoJykucmVtb3ZlQ2xhc3MoJ3Nob3cnKTtcblxuICAgIC8qIHNob3cgcmVzdCBvZiBkYXRhIGFuZCBoaWRlIHNlYXJjaCB2aWV3Ki9cbiAgICAkKCcuanMtbm9uU2VhcmNoVmlldycpLnJlbW92ZUNsYXNzKCdoaWRlJyk7XG4gICAgJCgnLmpzLXNlYXJjaFZpZXcnKS5hZGRDbGFzcygnaGlkZScpO1xuICAgIC8vJCgnLmpzLXNlYXJjaFZpZXcnKS5lbXB0eSgpO1xuICAgIGlmICh3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUuaW5kZXhPZigndXNlcicpID09PSAtMSkge1xuICAgICAgd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lID0gJy91c2VyL2hvbWUnO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHNob3dVc2VyTWVudUQoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBjb25zdCB1c2VySWNvbiA9ICQoJyN1c2VyLW1lbnUnKTtcbiAgICBpZiAoIXVzZXJJY29uLmhhc0NsYXNzKCdzaG93JykpIHtcbiAgICAgICQoJyN1c2VyLW1lbnUnKS5hZGRDbGFzcygnc2hvdycpO1xuICAgIH0gZWxzZSB7XG4gICAgICAkKCcjdXNlci1tZW51JykucmVtb3ZlQ2xhc3MoJ3Nob3cnKTtcbiAgICB9XG5cbiAgfVxuXG4gIGZ1bmN0aW9uIHNob3dVc2VyTWVudShlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGNvbnN0IHVzZXJJY29uID0gJCgnI3VzZXItbWVudScpO1xuICAgICQoJyN1c2VyLW1lbnUnKS5hZGRDbGFzcygnc2hvdycpO1xuICAgIHVzZXJJY29uLmNzcygnd2lkdGgnLCAnMjUwcHgnKTtcbiAgICB1c2VySWNvbi5wcmVwZW5kKCc8ZGl2IGNsYXNzPVwiY2xvc2UtaWNvblwiPjxpIGNsYXNzPVwiZmkteFwiPjwvaT48L2Rpdj4nKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGhpZGVVc2VyTWVudShlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGNvbnN0IHVzZXJJY29uID0gJCgnI3VzZXItbWVudScpO1xuICAgICQoJyN1c2VyLW1lbnUnKS5yZW1vdmVDbGFzcygnc2hvdycpO1xuICAgIHVzZXJJY29uLmNzcygnd2lkdGgnLCAnMTgwcHgnKTtcbiAgICAkKCcuY2xvc2UtaWNvbicpLnJlbW92ZSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gY2hhbmdlVHJhY2soZSkge1xuICAgIGlmICghJCh0aGlzKS5oYXNDbGFzcygnaGlnaGxpZ2h0JykpIHtcbiAgICAgICQoJy50cmFja0xpc3QnKS5yZW1vdmVDbGFzcygnaGlnaGxpZ2h0Jyk7XG4gICAgICAkKCcudHJhY2tJdGVtJykucmVtb3ZlQ2xhc3MoJ2ZpLXNvdW5kJyk7XG4gICAgICAkKHRoaXMpLmFkZENsYXNzKCdoaWdobGlnaHQnKTtcbiAgICAgICQodGhpcykuZmluZCgnLnRyYWNrSXRlbScpLmFkZENsYXNzKCdmaS1zb3VuZCcpO1xuICAgICAgY29uc3QgdHJhY2tTcmMgPSAkKHRoaXMpLmRhdGEoJ3RyYWNrLXNyYycpO1xuICAgICAgLy9jb25zdCBzdHIgPSB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWU7XG4gICAgICAvL2NvbnN0IHBhdGggPSBzdHIuc3Vic3RyKDAsIHN0ci5sYXN0SW5kZXhPZihcIi9cIikgKyAxKTtcbiAgICAgIC8vY29uc3QgdHJhY2tJZCA9ICQodGhpcykuYXR0cignaWQnKTtcbiAgICAgIG1lZGlhRWxlLnNldFNyYyh0cmFja1NyYyk7XG4gICAgICBtZWRpYUVsZS5sb2FkKCk7XG4gICAgICBtZWRpYUVsZS5wbGF5KCk7XG4gICAgICAvL2hpc3RvcnkucHVzaFN0YXRlKHRyYWNrSWQsICcnLCBwYXRoICsgdHJhY2tJZCk7XG4gICAgfVxuXG4gIH1cblxuICAvKipcbiAgICogb24gcG9wc3RhdGUgaGlnaGxpZ2h0IHRoZSBwcm9wZXIgdHJhY2tcbiAgICovXG4gIC8vICQod2luZG93KS5vbigncG9wc3RhdGUnLCBmdW5jdGlvbihlKSB7XG4gIC8vICAgY29uc3QgdHJhY2tJZCA9IGUub3JpZ2luYWxFdmVudC5zdGF0ZTtcbiAgLy8gICBpZiAodHJhY2tJZCAhPT0gbnVsbCkge1xuICAvLyAgICAgY29uc3QgdHJhY2tTcmMgPSAkKGAjJHt0cmFja0lkfWApLmRhdGEoJ3RyYWNrLXNyYycpO1xuICAvLyAgICAgJCgnLnRyYWNrTGlzdCcpLnJlbW92ZUNsYXNzKCdoaWdobGlnaHQnKTtcbiAgLy8gICAgICQoJy50cmFja0l0ZW0nKS5yZW1vdmVDbGFzcygnZmktc291bmQnKTtcbiAgLy8gICAgICQoYCMke3RyYWNrSWR9YCkuYWRkQ2xhc3MoJ2hpZ2hsaWdodCcpO1xuICAvLyAgICAgJChgIyR7dHJhY2tJZH1gKS5maW5kKCcudHJhY2tJdGVtJykuYWRkQ2xhc3MoJ2ZpLXNvdW5kJyk7XG4gIC8vXG4gIC8vICAgICBtZWRpYUVsZS5zZXRTcmModHJhY2tTcmMpO1xuICAvLyAgICAgbWVkaWFFbGUubG9hZCgpO1xuICAvLyAgICAgbWVkaWFFbGUucGxheSgpO1xuICAvLyAgIH0gZWxzZSB7XG4gIC8vICAgICBjb25zdCBzdHIgPSB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWU7XG4gIC8vICAgICBjb25zdCBpZCA9IHN0ci5zdWJzdHIoc3RyLmxhc3RJbmRleE9mKFwiL1wiKSArIDEsIHN0ci5sZW5ndGgpO1xuICAvLyAgICAgY29uc3QgdHJhY2tTcmMgPSAkKGAjJHtpZH1gKS5kYXRhKCd0cmFjay1zcmMnKTtcbiAgLy8gICAgICQoJy50cmFja0xpc3QnKS5yZW1vdmVDbGFzcygnaGlnaGxpZ2h0Jyk7XG4gIC8vICAgICAkKCcudHJhY2tJdGVtJykucmVtb3ZlQ2xhc3MoJ2ZpLXNvdW5kJyk7XG4gIC8vICAgICAkKGAjJHtpZH1gKS5hZGRDbGFzcygnaGlnaGxpZ2h0Jyk7XG4gIC8vICAgICAkKGAjJHtpZH1gKS5maW5kKCcudHJhY2tJdGVtJykuYWRkQ2xhc3MoJ2ZpLXNvdW5kJyk7XG4gIC8vXG4gIC8vICAgICBtZWRpYUVsZS5zZXRTcmModHJhY2tTcmMpO1xuICAvLyAgICAgbWVkaWFFbGUubG9hZCgpO1xuICAvLyAgICAgbWVkaWFFbGUucGxheSgpO1xuICAvLyAgIH1cbiAgLy8gfSk7XG5cbiAgLyoqXG4gICAqIFNlYXJjaFxuICAgKi9cbiAgZnVuY3Rpb24gY2FsbFNlYXJjaChlKSB7XG4gICAgaWYgKGUua2V5Q29kZSA9PT0gMTMpIHtcbiAgICAgIHNlYXJjaChlKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBzZWFyY2goZSwgc3RyLCBwb3BzdGF0ZSkge1xuICAgIGlmIChlICE9PSBudWxsKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxuXG4gICAgJCgnLmpzLXNlYXJjaFZpZXcnKS5lbXB0eSgpO1xuICAgIHZhciBzZWFyY2hTdHJpbmcgPSAoc3RyICE9PSB1bmRlZmluZWQpID8gc3RyIDogJC50cmltKCQoJyNzZWFyY2gtdGV4dCcpLnZhbCgpKTsgLyogdHJpbSBiZWdpbm5pbmcgYW5kIGVuZGluZyBzcGFjZXMgKi9cbiAgICBzZWFyY2hTdHJpbmcgPSBzZWFyY2hTdHJpbmcucmVwbGFjZSgvXFxzKy9nLCAnICcpO1xuICAgIGlmIChzZWFyY2hTdHJpbmcubGVuZ3RoID4gMCAmJiBzZWFyY2hTdHJpbmcgIT09ICcgJykge1xuICAgICAgJC5wb3N0KGAvc2VhcmNoLyR7c2VhcmNoU3RyaW5nfWApXG4gICAgICAgIC5mYWlsKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICAgICAgICAkKCcjc2VhcmNoQ29udCcpLmh0bWwoZGF0YSk7XG4gICAgICAgIH0pXG4gICAgICAgIC5kb25lKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAkKCcjc2VhcmNoQ29udCcpLmh0bWwoZGF0YSk7XG4gICAgICAgICAgJCgnI2pzLXNlYXJjaFJlc3VsdHMnKS5yZW1vdmVDbGFzcygnaGlkZScpO1xuICAgICAgICAgIGlmIChwb3BzdGF0ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjb25zdCBzdHIgPSBgL3NlYXJjaC8ke3NlYXJjaFN0cmluZ31gO1xuICAgICAgICAgICAgaGlzdG9yeS5wdXNoU3RhdGUoe1xuICAgICAgICAgICAgICBzZWFyY2g6IHNlYXJjaFN0cmluZ1xuICAgICAgICAgICAgfSwgJycsIHN0cik7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBjb25zb2xlLmxvZyh3aW5kb3cuaGlzdG9yeS5zdGF0ZSk7XG4gIGNvbnNvbGUubG9nKHdpbmRvdy5oaXN0b3J5KTtcblxuICBpZiAod2luZG93Lmhpc3Rvcnkuc3RhdGUgIT09IG51bGwpIHtcbiAgICBjb25zdCBzdGF0ZSA9IHdpbmRvdy5oaXN0b3J5LnN0YXRlO1xuICAgIGlmIChzdGF0ZS5zZWFyY2ggIT09IHVuZGVmaW5lZCAmJiBzdGF0ZS5jYXRlZ29yeSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBkaXNwbGF5U2VhcmNoQmFyKCk7XG4gICAgICAkKCcjc2VhcmNoLXRleHQnKS52YWwoc3RhdGUuc2VhcmNoKTtcbiAgICAgIHNlYXJjaChudWxsLCBzdGF0ZS5zZWFyY2gsICdub1BvcHN0YXRlJyk7XG4gICAgfSBlbHNlIGlmIChzdGF0ZS5zZWFyY2ggIT09IHVuZGVmaW5lZCAmJiBzdGF0ZS5jYXRlZ29yeSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBkaXNwbGF5U2VhcmNoQmFyKCk7XG4gICAgICAkKCcjc2VhcmNoLXRleHQnKS52YWwoc3RhdGUuc2VhcmNoKTtcbiAgICAgIHNlZUFsbFJlc3VsdHMobnVsbCwgc3RhdGUuc2VhcmNoLCBzdGF0ZS5jYXRlZ29yeSwgJ25vUG9wc3RhdGUnKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogb24gcG9wc3RhdGUgaGlnaGxpZ2h0IGdldCB0aGUgcHJvcGVyIHZpZXdcbiAgICovXG5cbiAgJCh3aW5kb3cpLm9uKCdwb3BzdGF0ZScsIGZ1bmN0aW9uKGUpIHtcbiAgICBjb25zb2xlLmxvZyhlKTtcbiAgICBjb25zdCBzdGF0ZSA9IGUub3JpZ2luYWxFdmVudC5zdGF0ZTtcblxuICAgIGlmIChzdGF0ZSA9PT0gbnVsbCkge1xuICAgICAgY29uc3QgcGF0aCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBwYXRoO1xuICAgIH0gZWxzZSBpZiAoc3RhdGUuc2VhcmNoICE9PSB1bmRlZmluZWQgJiYgc3RhdGUuY2F0ZWdvcnkgPT09IHVuZGVmaW5lZCkge1xuICAgICAgZGlzcGxheVNlYXJjaEJhcihlKTtcbiAgICAgICQoJyNzZWFyY2gtdGV4dCcpLnZhbChzdGF0ZS5zZWFyY2gpO1xuICAgICAgc2VhcmNoKGUsIHN0YXRlLnNlYXJjaCwgJ25vUG9wc3RhdGUnKTtcbiAgICB9IGVsc2UgaWYgKHN0YXRlLnNlYXJjaCAhPT0gdW5kZWZpbmVkICYmIHN0YXRlLmNhdGVnb3J5ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGRpc3BsYXlTZWFyY2hCYXIoZSk7XG4gICAgICAkKCcjc2VhcmNoLXRleHQnKS52YWwoc3RhdGUuc2VhcmNoKTtcbiAgICAgIHNlZUFsbFJlc3VsdHMoZSwgc3RhdGUuc2VhcmNoLCBzdGF0ZS5jYXRlZ29yeSwgJ25vUG9wc3RhdGUnKTtcbiAgICB9XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIHNlZUFsbFJlc3VsdHMoZSwgc3JjaFN0ciwgY2F0ZWdyeSwgcG9wc3RhdGUpIHtcbiAgICBpZiAoZSAhPT0gbnVsbCkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH1cblxuICAgIGNvbnN0IHNlYXJjaFN0ciA9IChzcmNoU3RyICE9PSB1bmRlZmluZWQpID8gc3JjaFN0ciA6ICQoJy5zZWFyY2hTdHInKS5odG1sKCk7XG4gICAgY29uc3QgY2F0ZWdvcnkgPSAoY2F0ZWdyeSAhPT0gdW5kZWZpbmVkKSA/IGNhdGVncnkgOiAkKHRoaXMpLmRhdGEoJ2NhdGVnb3J5Jyk7XG5cbiAgICAkLnBvc3QoYC9zZWFyY2gvJHtjYXRlZ29yeX0vJHtzZWFyY2hTdHJ9YClcbiAgICAgIC5mYWlsKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgJCgnI3NlYXJjaENvbnQnKS5odG1sKGRhdGEpO1xuICAgICAgfSlcbiAgICAgIC5kb25lKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgJCgnI3NlYXJjaENvbnQnKS5odG1sKGRhdGEpO1xuICAgICAgICAkKCcjanMtc2VhcmNoUmVzdWx0cycpLnJlbW92ZUNsYXNzKCdoaWRlJyk7XG4gICAgICAgIGlmIChwb3BzdGF0ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgY29uc3Qgc3RyID0gYC9zZWFyY2gvJHtjYXRlZ29yeX0vJHtzZWFyY2hTdHJ9YDtcbiAgICAgICAgICBoaXN0b3J5LnB1c2hTdGF0ZSh7XG4gICAgICAgICAgICBzZWFyY2g6IHNlYXJjaFN0cixcbiAgICAgICAgICAgIGNhdGVnb3J5OiBjYXRlZ29yeVxuICAgICAgICAgIH0sICcnLCBzdHIpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGxpbmtBY3RpdmUoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAkKHRoaXMpLnRvZ2dsZUNsYXNzKCdhY3RpdmUnKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNyZWF0ZVBsYXlsaXN0KGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gIH1cblxuICAvKipcbiAgICogVXRpbGl0eSBmdW5jdGlvbnNcbiAgICovXG5cbiAgZnVuY3Rpb24gY2xlYXJNZXNzYWdlKCkge1xuICAgICQoJyNlcnJvcicpLmVtcHR5KCk7XG4gICAgJCgnI21zZycpLmVtcHR5KCk7XG4gICAgJCgnI2VtcHR5RmllbGRzJykuYWRkQ2xhc3MoJ2hpZGUnKTtcbiAgICAkKCcuaWNvbi1lcnJvcicpLnJlbW92ZSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gc2hvd01lc3NhZ2UobXNnVHh0LCBtc2dEaXYpIHtcbiAgICB2YXIgdWxFbGUgPSAkKCcjbXNnY29udCcpO1xuICAgIGlmICh1bEVsZS5sZW5ndGggPT09IDApIHtcbiAgICAgIHVsRWxlID0gJCgnPHVsIGlkPVxcJ21zZ2NvbnRcXCc+PC91bD4nKTtcbiAgICB9XG4gICAgdWxFbGUuYXBwZW5kKCc8bGk+JyArIG1zZ1R4dCArICc8L2xpPicpO1xuICAgICQoJyMnICsgbXNnRGl2KS5odG1sKHVsRWxlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNob3dFcnJvckNpcmNsZShjaXJjbGVJbnApIHtcbiAgICBjb25zdCBpbnBFbGUgPSAkKCcjJyArIGNpcmNsZUlucCk7XG4gICAgY29uc3Qgc3BhbkVsZSA9ICQoJzxzcGFuIGNsYXNzPVxcJ2ljb24tZXJyb3JcXCc+PGkgY2xhc3M9XFwnZmkteC1jaXJjbGVcXCc+PC9pPjwvc3Bhbj4nKTtcbiAgICBpbnBFbGUuYWZ0ZXIoc3BhbkVsZSk7XG4gIH1cblxuXG5cblxufSgpKTtcbiJdfQ==
