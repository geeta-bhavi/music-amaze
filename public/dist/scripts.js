"use strict";$(function(){var e=null;function s(){0===$("li.trackList.highlight").prev().length?$("#trackPrev").addClass("inactive"):$("#trackPrev").removeClass("inactive"),0===$("li.trackList.highlight").next().length?$("#trackNext").addClass("inactive"):$("#trackNext").removeClass("inactive"),0===$("li.trackList.highlight").prev().length&&0===$("li.trackList.highlight").next().length&&$("#trackShuffle").addClass("inactive")}$(document).foundation(),$(".screenText").slick({dots:!0,infinite:!0,speed:500,fade:!0,cssEase:"linear"}),window.location.pathname.indexOf("play")&&$("#audioPlayer").mediaelementplayer({stretching:"responsive",pluginPath:"../js/lib/build/",success:function(a,t,r){e=a,s(),$(a).on("ended",function(){if($("#trackShuffle").hasClass("active")){var t=$("li.trackList").length,r=Math.floor(Math.random()*t+1);(n=$("li.trackList:nth-child("+r+")")).hasClass("highlight")&&0===(n=n.next()).length&&(n=$("li.trackList:nth-child(1)")),n.click(),s()}else{var n=$("li.trackList.highlight").next();$("#trackRepeat").hasClass("active")?a.play():0===n.length?function(s){$(".trackList").removeClass("highlight"),$(".trackItem").removeClass("fi-sound"),s.addClass("highlight"),s.find(".trackItem").addClass("fi-sound");var a=s.data("track-src");e.setSrc(a),e.load()}($("li.trackList").first()):n.click(),s()}})},error:function(e,s){alert("There is some error at the server playing the track!")}}),$(window).on("load resize",function(){$("#footer");$(".title-bar").is(":visible")?$("#index-menu").removeClass("addFloat"):$("#index-menu").addClass("addFloat");$(window).width()<400?($(".menuDiv").addClass("menuMode"),$("#user-menu").removeClass("show")):($("#user-menu").removeClass("show"),$("#user-menu").css("width","180px"),$(".close-icon").remove(),$(".menuDiv").removeClass("menuMode"))}),$("#login").on("submit",function(e){e.preventDefault(),l();var s=$("#userName").val(),a=$("#userPassword").val();if(0!==s.length&&0!==a.length){var t=/^[a-zA-Z0-9._]{1,30}$/.test(s);t?$.post("/login",{username:s,password:a}).fail(function(e){var s=e.responseJSON;400===e.status&&d(s[0].msg,"error"),401===e.status&&d(s.msg,"error")}).done(function(e){window.location.href="/user/home"}):(c("userName"),d("Usernames can only use letters, numbers, underscores and periods.","error"))}else 0===s.length&&(c("userName"),$("#emptyFields").removeClass("hide")),0==a.length&&(c("userPassword"),$("#emptyFields").removeClass("hide"))}),$("#editProfile").on("submit",function(e){e.preventDefault(),l();var s=$("#userName").val(),a=$("#email").val();if(0!==s.length&&0!==a.length){var t=/^[a-zA-Z0-9._]{1,30}$/.test(s);t?$.post("/user/editProfile",{username:s,email:a}).fail(function(e){if(400===e.status){var s=e.responseJSON;s.length>=1?d(s[0].msg,"error"):d(s.msg,"error")}}).done(function(e){d(e.msg,"msg"),$("#loginLink").removeClass("hide"),$(".btns").addClass("hide")}):(c("userName"),d("Usernames can only use letters, numbers, underscores and periods.","error"))}else 0===s.length&&(c("userName"),$("#emptyFields").removeClass("hide")),0==a.length&&(c("email"),$("#emptyFields").removeClass("hide"))}),$("#confirmUser").on("submit",function(e){e.preventDefault(),l();var s=$("#username").val();0!==s.length?$.post("/verifyUser",{username:s}).fail(function(e){if(401===e.status){var s=e.responseJSON;d(s.msg,"error")}}).done(function(e){$("#username").val(""),$("#forgotPassword").removeClass("hide"),$("#confirmUser").addClass("hide"),a=e}):0===s.length&&(c("username"),$("#emptyFields").removeClass("hide"))}),$("#forgotPassword").on("submit",function(e){e.preventDefault(),l();var s=$("#newPassword").val(),t=$("#confirmPassword").val();0===s.length&&(c("newPassword"),$("#emptyFields").removeClass("hide"));0===t.length&&(c("confirmPassword"),$("#emptyFields").removeClass("hide"));0!==s.length&&t!==s&&(c("confirmPassword"),$("#emptyFields").addClass("hide"),d("Confirm password doesn't match with the new password","error"));0!==s.length&&0!==t.length&&s===t&&$.post("/forgotPassword",{newPassword:s,user:a}).fail(function(e){if(400===e.status){var s=e.responseJSON;d(s.msg,"error")}}).done(function(e){d(e.msg,"msg"),$(".btns").addClass("hide"),$("#loginLink").removeClass("hide")})}),$("#signup").on("submit",function(e){e.preventDefault(),l();var s=$("#userName").val(),a=$("#userEmail").val(),t=$("#userPassword").val(),r=$("#confirmPassword").val(),n=/^[a-zA-Z0-9._]{1,30}$/.test(s);0===s.length&&(c("userName"),$("#emptyFields").removeClass("hide"));n||0===s.length||(c("userName"),d("Usernames can only use letters, numbers, underscores and periods.","error"));0===a.length&&(c("userEmail"),$("#emptyFields").removeClass("hide"));0===t.length&&(c("userPassword"),$("#emptyFields").removeClass("hide"));0===r.length&&(c("confirmPassword"),$("#emptyFields").removeClass("hide"));0!==t.length&&0!==r.length&&r!==t&&(c("confirmPassword"),$("#emptyFields").addClass("hide"),d("Confirm password doesn't match with password","error"),0!==a.length&&0!==s.length||$("#emptyFields").removeClass("hide"));0!==s.length&&0!==t.length&&0!==r.length&&0!==a.length&&t===r&&n&&$.post("/signup",{username:s,password:t,email:a}).fail(function(e){if(400===e.status){var s=e.responseJSON;s.length>=1?d(s[0].msg,"error"):d(s.msg,"error")}}).done(function(e){d(e.msg,"msg"),$(".btns").addClass("hide"),$("#loginLink").removeClass("hide")})}),$("#reset").on("click",l),$("#changePassword").on("submit",function(e){e.preventDefault(),l();var s=$("#oldPassword").val(),a=$("#newPassword").val(),t=$("#confirmPassword").val();0===s.length&&(c("oldPassword"),$("#emptyFields").removeClass("hide"));0===a.length&&(c("newPassword"),$("#emptyFields").removeClass("hide"));0===t.length&&(c("confirmPassword"),$("#emptyFields").removeClass("hide"));0!==a.length&&0!==t.length&&t!==a&&(c("confirmPassword"),$("#emptyFields").addClass("hide"),d("Confirm password doesn't match with the new password","error"),0===s.length&&$("#emptyFields").removeClass("hide"));0!==s.length&&0!==a.length&&0!==t.length&&a===t&&$.post("/user/changePassword",{oldPassword:s,newPassword:a}).fail(function(e){if(400===e.status){var s=e.responseJSON;d(s.msg,"error")}}).done(function(e){d(e.msg,"msg"),$(".btns").addClass("hide"),$("#loginLink").removeClass("hide")})}),$("#searchIcon").on("click",t),$(".js-search-close").on("click",function(e){e.preventDefault(),$("#search-text").val(""),$("#headerDiv").removeClass("hide").addClass("show"),$("#search").removeClass("show"),$(".js-nonSearchView").removeClass("hide"),$(".js-searchView").addClass("hide"),-1===window.location.pathname.indexOf("user")&&(window.location.pathname="/user/home")}),$(".menuDiv").on("click",function(e){e.preventDefault(),$("#user-menu").hasClass("show")?$("#user-menu").removeClass("show"):$("#user-menu").addClass("show")}),$(".trackList").on("click",function(s){if(!$(this).hasClass("highlight")){$(".trackList").removeClass("highlight"),$(".trackItem").removeClass("fi-sound"),$(this).addClass("highlight"),$(this).find(".trackItem").addClass("fi-sound");var a=$(this).data("track-src");e.setSrc(a),e.load(),e.play()}}),$("#search-text").on("keyup",function(e){13===e.keyCode&&r(e)}),$(".js-search-icon").on("click",r),$("#trackRepeat").on("click",o),$("#trackLike").on("click",o),$("#trackPrev").on("click",function(e){e.preventDefault(),$(this).hasClass("inactive")||($("li.trackList.highlight").prev().click(),s())}),$("#trackNext").on("click",function(e){e.preventDefault(),$(this).hasClass("inactive")||($("li.trackList.highlight").next().click(),s())}),$("#trackShuffle").on("click",function(e){e.preventDefault(),$(this).hasClass("inactive")||$(this).toggleClass("active")}),$(document).on("click",".menuMode",function(e){e.preventDefault();var s=$("#user-menu");$("#user-menu").addClass("show"),s.css("width","250px"),s.prepend('<div class="close-icon"><i class="fi-x"></i></div>')}),$(document).on("click",".close-icon",function(e){e.preventDefault();var s=$("#user-menu");$("#user-menu").removeClass("show"),s.css("width","180px"),$(".close-icon").remove()}),$(document).on("click",".seeAllR",i);var a=null;function t(e){e&&e.preventDefault(),$("#headerDiv").removeClass("show").addClass("hide"),$("#search").addClass("show"),$(".js-nonSearchView").addClass("hide"),$(".js-searchView").removeClass("hide")}function r(e,s,a){null!==e&&e.preventDefault(),$(".js-searchView").empty();var t=void 0!==s?s:$.trim($("#search-text").val());(t=t.replace(/\s+/g," ")).length>0&&" "!==t&&$.post("/search/"+t).fail(function(e){console.log(e),$("#searchCont").html(e)}).done(function(e){if($("#searchCont").html(e),$("#js-searchResults").removeClass("hide"),void 0===a){var s="/search/"+t;history.pushState({search:t},"",s)}})}if(console.log(window.history.state),console.log(window.history),null!==window.history.state){var n=window.history.state;void 0!==n.search&&void 0===n.category?(t(),r(null,n.search,"noPopstate")):void 0!==n.search&&void 0!==n.category&&(t(),i(null,n.search,n.category,"noPopstate"))}function i(e,s,a,t){null!==e&&e.preventDefault();var r=void 0!==s?s:$(".searchStr").html(),n=void 0!==a?a:$(this).data("category");$.post("/search/"+n+"/"+r).fail(function(e){$("#searchCont").html(e)}).done(function(e){if($("#searchCont").html(e),$("#js-searchResults").removeClass("hide"),void 0===t){var s="/search/"+n+"/"+r;history.pushState({search:r,category:n},"",s)}})}function o(e){e.preventDefault(),$(this).toggleClass("active")}function l(){$("#error").empty(),$("#msg").empty(),$("#emptyFields").addClass("hide"),$(".icon-error").remove()}function d(e,s){var a=$("#msgcont");0===a.length&&(a=$("<ul id='msgcont'></ul>")),a.append("<li>"+e+"</li>"),$("#"+s).html(a)}function c(e){var s=$("#"+e),a=$("<span class='icon-error'><i class='fi-x-circle'></i></span>");s.after(a)}$(window).on("popstate",function(e){console.log(e);var s=e.originalEvent.state;if(null===s){var a=window.location.href;window.location.href=a}else void 0!==s.search&&void 0===s.category?(t(e),r(e,s.search,"noPopstate")):void 0!==s.search&&void 0!==s.category&&(t(e),i(e,s.search,s.category,"noPopstate"))})}());
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiJCIsIm1lZGlhRWxlIiwiaGlnaExpZ2h0UHJldk5leHQiLCJwcmV2IiwibGVuZ3RoIiwiYWRkQ2xhc3MiLCJyZW1vdmVDbGFzcyIsIm5leHQiLCJkb2N1bWVudCIsImZvdW5kYXRpb24iLCJzbGljayIsImRvdHMiLCJpbmZpbml0ZSIsInNwZWVkIiwid2luZG93IiwibG9jYXRpb24iLCJwYXRobmFtZSIsImluZGV4T2YiLCJtZWRpYWVsZW1lbnRwbGF5ZXIiLCJwbHVnaW5QYXRoIiwic3VjY2VzcyIsIm1lZGlhRWxlbWVudCIsIm9yaWdpbmFsTm9kZSIsImluc3RhbmNlIiwib24iLCJoYXNDbGFzcyIsInJhbmRvbSIsIk1hdGgiLCJmbG9vciIsImxpQ291bnQiLCJsaUVsZSIsImNsaWNrIiwicGxheSIsImZpbmQiLCJ0cmFja1NyYyIsImRhdGEiLCJzZXRTcmMiLCJsb2FkIiwiY2FsbEZvY3VzIiwiZmlyc3QiLCJlcnJvciIsImFsZXJ0IiwiaXMiLCJ3aWR0aCIsInJlbW92ZSIsImNsZWFyTWVzc2FnZSIsImUiLCJwcmV2ZW50RGVmYXVsdCIsIm5hbWUiLCJ2YWwiLCJuYW1lVmVyaWZpZXMiLCJ1c2VyTmFtZVJlZ2V4IiwidGVzdCIsInVzZXJuYW1lIiwicGFzc3dvcmQiLCJmYWlsIiwicmVzcG9uc2VUZXh0Iiwic2hvd01lc3NhZ2UiLCJyZXNwb25zZUpTT04iLCJzdGF0dXMiLCJtc2ciLCJocmVmIiwic2hvd0Vycm9yQ2lyY2xlIiwicHdkIiwiaGFuZGxlVXBkYXRlUHJvZmlsZSIsInBhdHRlcm4iLCJlbWFpbCIsInBvc3QiLCJ1c2VyIiwiZG9uZSIsImhhbmRsZVVwZGF0ZVBhc3N3b3JkIiwibmV3UHdkIiwiY29uZmlybVB3ZCIsIm5ld1Bhc3N3b3JkIiwiaGFuZGxlQ2hhbmdlUGFzc3dvcmQiLCJvbGRQd2QiLCJjb25maXJtcHdkIiwiZGlzcGxheVNlYXJjaEJhciIsIm9sZFBhc3N3b3JkIiwic2hvd1VzZXJNZW51IiwidXNlckljb24iLCJoaWRlVXNlck1lbnUiLCJ0aGlzIiwic2VhcmNoIiwic2VhcmNoU3RyaW5nIiwia2V5Q29kZSIsImxpbmtBY3RpdmUiLCJ0b2dnbGVDbGFzcyIsImNzcyIsInNlZUFsbFJlc3VsdHMiLCJzaG93VXNlck1lbnVEIiwic3RyIiwicG9wc3RhdGUiLCJjb25zb2xlIiwiaGlzdG9yeSIsInN0YXRlIiwidW5kZWZpbmVkIiwiY2F0ZWdvcnkiLCJ0cmltIiwiaHRtbCIsInB1c2hTdGF0ZSIsImxvZyIsIm9yaWdpbmFsRXZlbnQiLCJzcmNoU3RyIiwiY2F0ZWdyeSIsInNlYXJjaFN0ciIsInVsRWxlIiwibXNnVHh0IiwiYXBwZW5kIiwibXNnRGl2IiwiaW5wRWxlIiwiYWZ0ZXIiLCJzcGFuRWxlIiwiZW1wdHkiLCJjaXJjbGVJbnAiLCJwYXRoIl0sIm1hcHBpbmdzIjoiYUFBQUEsRUFBRSxXQUFBLElBQUFDLEVBQVcsS0FpR1gsU0FBU0MsSUFDMkMsSUFBOUNGLEVBQUUsMEJBQTBCRyxPQUFPQyxPQUNyQ0osRUFBRSxjQUFjSyxTQUFTLFlBRXpCTCxFQUFFLGNBQWNNLFlBQVksWUFFb0IsSUFBOUNOLEVBQUUsMEJBQTBCTyxPQUFPSCxPQUNyQ0osRUFBRSxjQUFjSyxTQUFTLFlBRXpCTCxFQUFFLGNBQWNNLFlBQVksWUFHb0IsSUFBOUNOLEVBQUUsMEJBQTBCRyxPQUFPQyxRQUE4RCxJQUE5Q0osRUFBRSwwQkFBMEJPLE9BQU9ILFFBQ3hGSixFQUFFLGlCQUFpQkssU0FBUyxZQXZHaENMLEVBQUVRLFVBQVVDLGFBS1pULEVBQUUsZUFBZVUsT0FDZkMsTUFBTSxFQUROQyxVQUFBLEVBQ0FELE1BQU0sSUFDTkMsTUFBQUEsRUFDQUMsUUFBTyxXQVFMQyxPQUFPQyxTQUFTQyxTQUFTQyxRQUFRLFNBQ25DakIsRUFBRSxnQkFBZ0JrQixvQkFEaEJKLFdBQU9DLGFBQ1BJLFdBQUEsbUJBR0FDLFFBQUEsU0FBQUMsRUFBQUMsRUFBQUMsR0FDQXRCLEVBQUFvQixFQUNBRCxJQUtFcEIsRUFBRXFCLEdBQWNHLEdBQUcsUUFBUyxXQUQ1QixHQUFBeEIsRUFBQSxpQkFBQXlCLFNBQUEsVUFBQSxDQUNFSixJQUFBQSxFQUFpQnJCLEVBQUEsZ0JBQVNJLE9BQ3BCc0IsRUFBQUMsS0FBRkMsTUFBbUJILEtBQVNDLFNBQVdHLEVBQUEsSUFDbkNBLEVBQUFBLEVBQVU3QiwwQkFBaEIwQixFQUFBLE1BS1VELFNBQVMsY0FDakIsS0FERkssRUFBVUwsRUFBQUEsUUFDQUssU0FDUkEsRUFBVTFCLEVBQUFBLDhCQUtaMEIsRUFBTUMsUUFBTkQsUUFHSyxDQUNMLElBQUlBLEVBQVE5QixFQUFFLDBCQUEwQk8sT0FDcENQLEVBQUUsZ0JBQWdCeUIsU0FBUyxVQUM3QkosRUFBYVcsT0FFUSxJQUFqQkYsRUFBTTFCLE9BMER0QixTQUFtQjBCLEdBQ2pCOUIsRUFBRSxjQUFjTSxZQUFZLGFBQzVCTixFQUFFLGNBQWNNLFlBQVksWUFDNUJ3QixFQUFNekIsU0FBUyxhQUNmeUIsRUFBTUcsS0FBSyxjQUFjNUIsU0FBUyxZQUNsQyxJQUFNNkIsRUFBV0osRUFBTUssS0FBSyxhQUk1QmxDLEVBQVNtQyxPQUFPRixHQUNoQmpDLEVBQVNvQyxPQW5FR0MsQ0FBVXRDLEVBQUUsZ0JBQWdCdUMsU0FFNUJULEVBQU1DLFFBR1Y3QixRQUlOc0MsTUFBTyxTQUFBbkIsRUFBU0EsR0FDZG9CLE1BQU0sMkRBZ0VaekMsRUFBRWMsUUFBUVUsR0FBRyxjQThCWCxXQUNJeEIsRUFBRixXQURGQSxFQUFBLGNBRU8wQyxHQUFBLFlBQ0wxQyxFQUFFLGVBQWVLLFlBQVMsWUFFNUJMLEVBQUkyQyxlQUFVN0IsU0FBRixZQUVSZCxFQUFGYyxRQUFjVCxRQUNaLEtBRkpMLEVBQUEsWUFHT0ssU0FBQSxZQUNMTCxFQUFFLGNBQWNNLFlBQVksVUFFNUJOLEVBQUUsY0FBRk0sWUFBQSxRQUNBTixFQUFFLGNBQVlNLElBQUFBLFFBQVksU0FDM0JOLEVBQUEsZUFBQTRDLFNBQ0Y1QyxFQUFBLFlBQUFNLFlBQUEsZUE1Q0ROLEVBQUUsVUFBVXdCLEdBQUcsU0FnRGJxQixTQUFBQSxHQUNBQyxFQUFBQyxpQkFDQUYsSUFEQSxJQUFNRyxFQUFPaEQsRUFBRSxhQUFhaUQsTUFHeEJELEVBQUs1QyxFQUFBQSxpQkFBb0JBLE1BRTNCLEdBQU04QyxJQUFORixFQUFNRSxRQUFrQ0YsSUFBbkJHLEVBQUFBLE9BQW1CSCxDQUR4QyxJQUdJRSxFQUhrQix3QkFHSkUsS0FBQUosR0FFWkssRUFDQUMsRUFBQUEsS0FBQUEsVUFFREMsU0FBS1AsRUFDSk0sU0FBTUUsSUFFSkMsS0FBQUEsU0FBWUQsR0FDYixJQUFBQSxFQUFBckIsRUFBQXVCLGFBQ21CLE1BQWhCdkIsRUFBS3dCLFFBQ1BGLEVBQVlELEVBQWFJLEdBQUtBLElBQUEsU0FHYixNQUFmekIsRUFBQXdCLFFBQ0o3QyxFQUFnQitDLEVBQU9ELElBQUEsV0FHM0JFLEtBQUFBLFNBQWdCM0IsR0FDaEJzQixPQUFBQSxTQUFZSSxLQUFBLGdCQURaQyxFQUFnQixZQU1sQkwsRUFBU3JELG9FQUFjLGVBS0wsSUFBaEIwRCxFQUFBQSxTQUNBOUQsRUFBQSxZQUNEQSxFQUFBLGdCQUFBTSxZQUFBLFNBRUosR0FBQXlELEVBQUEzRCxTQUpLMEQsRUFBZ0IsZ0JBTXRCOUQsRUFBQSxnQkFBU2dFLFlBQXVCLFdBMUZoQ2hFLEVBQUUsZ0JBQWdCd0IsR0FBRyxTQStGbkIsU0FBbUJzQixHQUNuQkEsRUFBQUMsaUJBRUFGLElBRUUsSUFBTW9CLEVBQVVqRSxFQUFBLGFBQUFpRCxNQUNWQyxFQUFBQSxFQUFBQSxVQUFlZSxNQUVuQmpFLEdBQU8sSUFBUEEsRUFBT0ksUUFBcUIsSUFBckI4RCxFQUFxQjlELE9BQUEsQ0FFeEI4RCxJQUVEWCxFQUZRVyx3QkFFWWQsS0FBQUMsR0FDbkJILEVBQ0VsRCxFQUFBbUUsS0FBQSxxQkFDQWQsU0FBSUcsRUFDRkMsTUFBQUEsSUFFQUEsS0FBQUEsU0FBQUEsR0FDRCxHQUFBLE1BQUF0QixFQUFBd0IsT0FBQSxDQUNGLElBQUFILEVBQUFyQixFQUFBdUIsYUFFR0YsRUFBQXBELFFBQWUsRUFDbkJxRCxFQUFpQkcsRUFBakIsR0FBQUEsSUFBQSxTQUVFSCxFQUFTcEQsRUFBWHVELElBQUEsWUFJSkgsS0FBQUEsU0FBWXRCLEdBRWJzQixFQUFBdEIsRUFBQXlCLElBQUEsT0FDSTVELEVBQUEsY0FBQU0sWUFBQSxRQUNEK0MsRUFBQUEsU0FBU2pELFNBQWIsV0FHQzBELEVBQUEsWUFDREwsRUFBVXJELG9FQUFhLGVBSXhCLElBQUFpRCxFQUFBakQsU0FDRjBELEVBQUEsWUFQSzlELEVBQUUsZ0JBQWdCTSxZQUFZLFNBVWxDLEdBQUV5QyxFQUFBQSxTQVBFZSxFQUFnQixTQVNwQmpCLEVBQUFBLGdCQUFBQSxZQUFBQSxXQTdJRjdDLEVBQUUsZ0JBQWdCd0IsR0FBRyxTQTBJckIsU0FBMEJzQixHQVN0QjlDLEVBQUFBLGlCQUFzQjZDLElBS2hCLElBQUFRLEVBQU1HLEVBQUFBLGFBQW9CRSxNQUUzQixJQUFBTCxFQUFBakQsT0FHREosRUFBQUEsS0FBRSxlQUNBcUQsU0FBQUEsSUFFRmUsS0FBQUEsU0FBQWpDLEdBYkosR0FBQSxNQUFBQSxFQUFBd0IsT0FBQSxDQWdCSyxJQUFBSCxFQUFBckIsRUFBQXVCLGFBQ0RMLEVBQVNqRCxFQUFjd0QsSUFBQSxZQUcxQlMsS0FBQSxTQUFBbEMsR0FDRm5DLEVBQUEsYUFBQWlELElBQUEsSUFDRmpELEVBQUEsbUJBQUFNLFlBQUEsUUFWT04sRUFBRSxnQkFBZ0JLLFNBQVMsUUFZbkMrRCxFQUFTRSxJQUlVLElBQVhDLEVBQVduRSxTQUNYb0UsRUFBZSxZQVZqQnhFLEVBQUUsZ0JBQWdCTSxZQUFZLFdBcktwQ04sRUFBRSxtQkFBbUJ3QixHQUFHLFNBMEt4QixTQUE4QnNCLEdBWTVCQSxFQUFBQyxpQkFDRWUsSUFFRCxJQUFBUyxFQUFBdkUsRUFBQSxnQkFBQWlELE1BVkt1QixFQUFheEUsRUFBRSxvQkFBb0JpRCxNQWF2QixJQUFoQmEsRUFBQUEsU0FDQTlELEVBQUEsZUFDQXlELEVBQUFBLGdCQUFZbkQsWUFBQSxTQUdWLElBQUFpRSxFQUFPbkUsU0FDVEosRUFBTyxtQkFDSHlFLEVBQUFBLGdCQUFhRixZQURTLFNBS2xCLElBQUpBLEVBQUlwQyxRQUFKcUMsSUFBeUJELElBQ3ZCVCxFQUFNTixtQkFDTkMsRUFBQUEsZ0JBQVlELFNBQUFBLFFBQ2JDLEVBQUEsdURBQUEsVUFJVXBELElBQVhMLEVBQUVJLFFBQUYsSUFBb0JvRSxFQUFwQnBFLFFBQUFtRSxJQUFBQyxHQUNBeEUsRUFBQUEsS0FBRSxtQkFiTnlFLFlBQUFGLEVBZURILEtBQUFBLElBWEliLEtBQUssU0FBU3BCLEdBY3JCLEdBQVN1QyxNQUFBQSxFQUFBQSxPQUF3QixDQUM3QjNCLElBQUFBLEVBQUZaLEVBQUF1QixhQUNBYixFQUFBQSxFQUFBQSxJQUFBQSxZQUdNMEIsS0FBQUEsU0FBV3BDLEdBQ1hxQyxFQUFheEUsRUFBRTRELElBQUEsT0FaZjVELEVBQUUsU0FBU0ssU0FBUyxRQWN0QnNFLEVBQUFBLGNBQWtCckUsWUFBRyxZQTNOM0JOLEVBQUUsV0FBV3dCLEdBQUcsU0E0UlppQyxTQUFZWCxHQUNiQSxFQUFBQyxpQkFsQkRGLElBcUJFaUIsSUFBQUEsRUFBQUEsRUFBQUEsYUFBZ0JiLE1BQ2RpQixFQUFBbEUsRUFBQSxjQUFnQk0sTUFDbkJ5RCxFQUFBL0QsRUFBQSxpQkFBQWlELE1BbEJLMkIsRUFBYTVFLEVBQUUsb0JBQW9CaUQsTUFxQnZDYSxFQURvQix3QkFDcEJWLEtBQUFKLEdBaEJrQixJQUFoQkEsRUFBSzVDLFNBb0JUMEQsRUFBZTFELFlBQ2IwRCxFQUFBQSxnQkFBZ0J4RCxZQUFBLFNBaEJiNEMsR0FBZ0MsSUFBaEJGLEVBQUs1QyxTQW9CMUIwRCxFQUFJLFlBQ0ZBLEVBQUFBLG9FQUFBLFVBR0ksSUFBSkksRUFBSUEsU0FDRmxFLEVBQUUsYUFDSEEsRUFBQSxnQkFBQU0sWUFBQSxTQUdILElBQUF5RCxFQUFBM0QsU0FDQTBELEVBQUEsZ0JBQ0E5RCxFQUFBLGdCQUFBTSxZQUFBLFNBSW9CLElBQWhCNkQsRUFBSy9ELFNBQ0hpRCxFQURjLG1CQUVkQyxFQUFBQSxnQkFGY2hELFlBQUEsU0FNVixJQUFKeUQsRUFBSTVCLFFBQXFCLElBQUx5QyxFQUFLeEUsUUFBQXdFLElBQUFiLElBQ3ZCRCxFQUFNTixtQkFDTnhELEVBQUEsZ0JBQUl3RCxTQUFBLFFBQ0ZDLEVBQUFBLCtDQUFBLFNBQ0ssSUFBTlMsRUFGRDlELFFBRU8sSUFBQTRDLEVBQUE1QyxRQUNMcUQsRUFBQUEsZ0JBQVlELFlBQWFJLFNBU2xDLElBQUFaLEVBQUE1QyxRQUFBLElBQUEyRCxFQUFBM0QsUUFBQSxJQUFBd0UsRUFBQXhFLFFBQ0YsSUFBQThELEVBQUE5RCxRQUFBMkQsSUFBQWEsR0FBQTFCLEdBckJHbEQsRUFBRW1FLEtBQUssV0F1QlhkLFNBQVN3QixFQUNQdkIsU0FBT1MsRUFDSGhCLE1BQUFBLElBcEJDUSxLQUFLLFNBQVNwQixHQXVCakIsR0FBYzdCLE1BQWQ2QixFQUFGd0IsT0FBNEIsQ0FDMUIsSUFBV3RELEVBQWI4QixFQUFBdUIsYUFyQllGLEVBQWFwRCxRQUFVLEVBdUJuQ3FELEVBQUFELEVBQUEsR0FBQUksSUFBQSxTQUVFSCxFQUFrQm5ELEVBQVlzRCxJQUFoQyxZQUlFYixLQUFBQSxTQUFGWixHQUNFc0IsRUFBZ0JSLEVBQUlXLElBQXRCLE9BQ0U1RCxFQUFBLFNBQWNNLFNBQUFBLFFBQ2ROLEVBQUEsY0FBV00sWUFBYixZQXBXRk4sRUFBRSxVQUFVd0IsR0FBRyxRQUFTcUIsR0FDeEI3QyxFQUFFLG1CQUFtQndCLEdBQUcsU0E4TnRCLFNBQXlCc0IsR0FDdkJnQixFQUFBQSxpQkFDQTlELElBWEYsSUFBTTJFLEVBQVMzRSxFQUFFLGdCQUFnQmlELE1BYzdCdUIsRUFBV3BFLEVBQUFBLGdCQUFjNkMsTUFDM0JhLEVBQWdCOUQsRUFBQSxvQkFBaEJpRCxNQUVELElBQUEwQixFQUFBdkUsU0FaQzBELEVBQWdCLGVBY2xCOUQsRUFBSXVFLGdCQUFBakUsWUFBdUJrRSxTQUdiLElBQVpmLEVBQUFBLFNBQ0FLLEVBQVcxRCxlQUNUSixFQUFBQSxnQkFBQU0sWUFBa0JBLFNBVkksSUFBdEJrRSxFQUFXcEUsU0FjZjBELEVBQUksbUJBQ0Y5RCxFQUFFbUUsZ0JBQUs3RCxZQUFQLFNBSWlCNkIsSUFKakJvQyxFQUlRbkUsUUFBZSxJQUFBb0UsRUFBQXBFLFFBQUFvRSxJQUFBRCxJQUNuQlQsRUFBU0gsbUJBQ1AzRCxFQUFBLGdCQUFNd0QsU0FBZXJCLFFBQ3JCc0IsRUFBQUEsdURBQUEsU0FDRCxJQUFBa0IsRUFBQXZFLFFBUkxKLEVBVUdxRSxnQkFBY2xDLFlBQU0sU0FWdkIsSUFBQXdDLEVBQUF2RSxRQUFBLElBQUFtRSxFQUFBbkUsUUFBQSxJQUFBb0UsRUFBQXBFLFFBQUFtRSxJQUFBQyxHQWVEeEUsRUFBQW1FLEtBQUEsd0JBSUZXLFlBQUFILEVBakJPRixZQUFhRixJQW9CakJ4QixLQUFBQSxTQUFGWixHQUNBVSxHQUFBQSxNQUFBQSxFQUFBQSxPQUFBQSxDQWpCUSxJQUFNVyxFQUFlckIsRUFBS3VCLGFBbUI1QlYsRUFBU1EsRUFBZkksSUFBQSxZQUdNZ0IsS0FBQUEsU0FBZXpDLEdBQ2ZnQixFQUFBQSxFQUFnQlMsSUFBQSxPQUNoQlYsRUFBQUEsU0FBQUEsU0FBZUMsUUFqQmZuRCxFQUFFLGNBQWNNLFlBQVksWUE5UHBDTixFQUFFLGVBQWV3QixHQUFHLFFBQVNxRCxHQUM3QjdFLEVBQUUsb0JBQW9Cd0IsR0FBRyxRQW1YdEIsU0FBQXNCLEdBRUZBLEVBQUFDLGlCQXRCQy9DLEVBQUUsZ0JBQWdCaUQsSUFBSSxJQXdCeEJqRCxFQUFBLGNBQVMrRSxZQUFnQixRQUFBMUUsU0FBQSxRQUN2QnlDLEVBQUVDLFdBQUFBLFlBQUYsUUFHQWlDLEVBQUFBLHFCQUFzQjFFLFlBQXRCLFFBQ0EwRSxFQUFBQSxrQkFBaUIzRSxTQUFBLFNBckJpQyxJQUE5Q1MsT0FBT0MsU0FBU0MsU0FBU0MsUUFBUSxVQXdCdkNILE9BQVNtRSxTQUFBQSxTQUFnQixnQkE5WHpCakYsRUFBRSxZQUFZd0IsR0FBRyxRQWtZZndELFNBQUFsQyxHQUNBOUMsRUFBRStDLGlCQUNIL0MsRUFBQSxjQXRCZXlCLFNBQVMsUUEwQnJCekIsRUFBRSxjQUFjTSxZQUFZLFFBRmhDTixFQUFBLGNBQUFLLFNBQXdCLFVBcll4QkwsRUFBRSxjQUFjd0IsR0FBRyxRQTZabkIsU0FBQXNCLEdBQ0EsSUFBQTlDLEVBQUFrRixNQUFBekQsU0FBQSxhQUFBLENBQ0F6QixFQUFBLGNBQUFNLFlBQUEsYUFDQU4sRUFBQSxjQUFBTSxZQUFBLFlBQ0FOLEVBQUFrRixNQUFBN0UsU0FBQSxhQUNBTCxFQUFBa0YsTUFBQWpELEtBQUEsY0FBQTVCLFNBQUEsWUFDQSxJQUFBNkIsRUFBQWxDLEVBQUFrRixNQUFBL0MsS0FBQSxhQUlBbEMsRUFBQW1DLE9BQUFGLEdBQ0FqQyxFQUFBb0MsT0FDQXBDLEVBQUErQixVQXhhQWhDLEVBQUUsZ0JBQWdCd0IsR0FBRyxRQWlkVDJELFNBQVFDLEdBRFYsS0FBa0J0QyxFQUFBdUMsU0FHbkJGLEVBQUFyQyxLQWxkVDlDLEVBQUUsbUJBQW1Cd0IsR0FBRyxRQUFTMkQsR0FDakNuRixFQUFFLGdCQUFnQndCLEdBQUcsUUFBUzhELEdBQzlCdEYsRUFBRSxjQUFjd0IsR0FBRyxRQUFTOEQsR0FDNUJ0RixFQUFFLGNBQWN3QixHQUFHLFFBcEVuQixTQUFzQnNCLEdBQ3BCQSxFQUFFQyxpQkFDRy9DLEVBQUVrRixNQUFNekQsU0FBUyxjQUNSekIsRUFBRSwwQkFBMEJHLE9BQ2xDNEIsUUFDTjdCLE9BZ0VKRixFQUFFLGNBQWN3QixHQUFHLFFBNURuQixTQUFrQnNCLEdBQ2hCQSxFQUFFQyxpQkFDRy9DLEVBQUVrRixNQUFNekQsU0FBUyxjQUNSekIsRUFBRSwwQkFBMEJPLE9BQ2xDd0IsUUFDTjdCLE9Bd0RKRixFQUFFLGlCQUFpQndCLEdBQUcsUUE3RXRCLFNBQXVCc0IsR0FDckJBLEVBQUVDLGlCQUNHL0MsRUFBRWtGLE1BQU16RCxTQUFTLGFBQ3BCekIsRUFBRWtGLE1BQU1LLFlBQVksWUEyRXhCdkYsRUFBRVEsVUFBVWdCLEdBQUcsUUFBUyxZQW9ZcEIsU0FBQXNCLEdBQ0FBLEVBQUFDLGlCQUNBLElBQUFpQyxFQUFBaEYsRUFBQSxjQUNBQyxFQUFBQSxjQUFTbUMsU0FBT0YsUUFDaEJqQyxFQUFBQSxJQUFTb0MsUUFBVCxTQUNBcEMsRUFBQUEsUUFBQSx3REF4WUpELEVBQUVRLFVBQVVnQixHQUFHLFFBQVMsY0E0WXZCLFNBQUFzQixHQXZCQ0EsRUFBRUMsaUJBeUJKLElBQUFpQyxFQUFBaEYsRUFBQSxjQXZCRUEsRUFBRSxjQUFjTSxZQUFZLFFBQzVCMEUsRUFBU1EsSUFBSSxRQUFTLFNBeUJ4QnhGLEVBQUEsZUFBQTRDLFdBaFpBNUMsRUFBRVEsVUFBVWdCLEdBQUcsUUFBUyxXQUFZaUUsR0FHcEMsSUFBSXJCLEVBQU8sS0F1VlQsU0FBQVMsRUFBQS9CLEdBQ0loQyxHQUNGQSxFQUFBQSxpQkFuQkZkLEVBQUUsY0FBY00sWUFBWSxRQUFRRCxTQUFTLFFBdUIvQ0wsRUFBQSxXQUFTMEYsU0FBVCxRQUdFMUYsRUFBQSxxQkFBdUJLLFNBQVMsUUFDOUJMLEVBQUFBLGtCQUFnQkssWUFBUyxRQWdGN0IsU0FBUzhFLEVBQU9yQyxFQUFHNkMsRUFBS0MsR0EyQlo5RSxPQUFaK0UsR0FDQUEsRUFBQUEsaUJBR0U3RixFQUFBLGtCQUFxQjhGLFFBQ3JCLElBQUlDLE9BQWlCQyxJQUFqQkwsRUFBb0NNLEVBQUFBLEVBQU5DLEtBQW1CRixFQUFBQSxnQkFBVy9DLFFBQzlENEIsRUFBQUEsRUFBQUEsUUFBQUEsT0FBQUEsTUFDYWtCLE9BQU1aLEdBQW5CLE1BQTJCQyxHQUY3QnBGLEVBQUFtRSxLQUFBLFdBR2lCZ0IsR0FDZk4sS0FBQUEsU0FBQUEsR0FDQVksUUFBQUEsSUFBY3RELEdBQ2ZuQyxFQUFBLGVBQUFtRyxLQUFBaEUsS0F4QklrQyxLQUFLLFNBQVNsQyxHQUdiLEdBd0JSbkMsRUFBQSxlQUFBbUcsS0FBQWhFLEdBekJRbkMsRUFBRSxxQkFBcUJNLFlBQVksYUFDbEIwRixJQUFiSixFQUF3QixDQUMxQixJQUFNRCxFQUFBQSxXQUFpQlAsRUEyQnZCNUQsUUFBRzRFLFdBQ0hDLE9BQVJqQixHQUNNVyxHQUFVTyxNQVNkekIsR0FIQUEsUUFBQUEsSUFBQUEsT0FBQUEsUUFBQWtCLE9BQ0FaLFFBQUFBLElBQUFyRSxPQUFVaUYsU0FFVixPQUFBbEIsT0FBQUEsUUFBQUEsTUFBQSxDQUNBWSxJQUFBQSxFQUFBQSxPQUFpQk0sUUFBTVosV0FDeEJhLElBQUFELEVBQUFaLGFBQUFhLElBQUFELEVBQUFFLFVBYkhwQixJQVhJTSxFQUFPLEtBQU1ZLEVBQU1aLE9BQVEsb0JBMkJMb0IsSUFBakJkLEVBQUFBLGFBQTZDTyxJQUF0REQsRUFBNENILFdBQzFDZixJQUNFL0IsRUFBRUMsS0FBRmdELEVBQUFaLE9BQUFZLEVBQUFFLFNBQUEsZUEwQkgsU0FBQVIsRUFBQTNDLEVBQUF5RCxFQUFBQyxFQUFBWixHQTNCVyxPQUFOOUMsR0E2Qk5BLEVBQUFDLGlCQXpCRSxJQUFNMEQsT0FBeUJULElBQVpPLEVBQXlCQSxFQUFVdkcsRUFBRSxjQUFjbUcsT0E2QnhFRixPQUF3QkQsSUFBZm5ELEVBQWUyRCxFQUFBeEcsRUFBQWtGLE1BQUEvQyxLQUFBLFlBRXRCbkMsRUFBRW1FLEtBQUZuRSxXQUFBaUcsRUFBQWpHLElBQUF5RyxHQUNFbEQsS0FBQSxTQUFGcEIsR0FDRW5DLEVBQUEsZUFBZTRDLEtBQWpCVCxLQTFCR2tDLEtBQUssU0FBU2xDLEdBK0JidUUsR0FGTjFHLEVBQUEsZUFBcUIyRyxLQUFyQnhFLEdBQ011RSxFQUFBQSxxQkFBSnBHLFlBQUEsYUFDcUIwRixJQUFqQlUsRUFBb0IsQ0FDdEJBLElBQVVmLEVBQUFBLFdBQUFNLEVBQUEsSUFBVlEsRUFDRFgsUUFBQU0sV0FDS1EsT0FBT0gsRUFDTEksU0FBUVYsR0FDakIsR0FBQVIsTUFLQ21CLFNBQU9DLEVBQU1DLEdBQ2RsRSxFQUFBQyxpQkEvckJIL0MsRUFBQWtGLE1BQUFLLFlBQUEsVUEycUJFLFNBQVMxQyxJQUNQN0MsRUFBRSxVQUFVaUgsUUFDWmpILEVBQUUsUUFBUWlILFFBQ1ZqSCxFQUFFLGdCQUFnQkssU0FBUyxRQUMzQkwsRUFBRSxlQUFlNEMsU0FHbkIsU0FBU2EsRUFBWWtELEVBQVFFLEdBQzNCLElBQUlILEVBQVExRyxFQUFFLFlBQ08sSUFBakIwRyxFQUFNdEcsU0FDUnNHLEVBQVExRyxFQUFFLDJCQUVaMEcsRUFBTUUsT0FBTyxPQUFTRCxFQUFTLFNBQy9CM0csRUFBRSxJQUFNNkcsR0FBUVYsS0FBS08sR0FHdkIsU0FBUzVDLEVBQWdCb0QsR0FDdkIsSUFBTUosRUFBUzlHLEVBQUUsSUFBTWtILEdBQ2pCRixFQUFVaEgsRUFBRSwrREFDbEI4RyxFQUFPQyxNQUFNQyxHQTFDVmhILEVBQUFjLFFBQ0tVLEdBQUEsV0FBQSxTQUFlc0IsR0FDbkI5QyxRQUFFcUcsSUFBQXZELEdBQ0Y5QyxJQUFFK0YsRUFBQWpELEVBQUF3RCxjQUFxQmhHLE1BRXJCLEdBQU1xRixPQUFOSSxFQUFNSixDQUNORyxJQUFBQSxFQUFRTSxPQUFVckYsU0FBQThDLEtBQ2hCc0IsT0FBQUEsU0FBUXNCLEtBRFFVLFlBRU5sQixJQUFWQSxFQUFVQSxhQUFBQSxJQUFBQSxFQUFBQSxVQUZNcEIsRUFBbEIvQixHQUlEcUMsRUFBQXJDLEVBQUFpRCxFQUFBWixPQUFBLG9CQWJMYSxJQUFBRCxFQUFBWixhQUFBYSxJQUFBRCxFQUFBRSxXQWVEcEIsRUFBQS9CLEdBM0JHMkMsRUFBYzNDLEVBQUdpRCxFQUFNWixPQUFRWSxFQUFNRSxTQUFVLGlCQXJvQm5EIiwiZmlsZSI6InNjcmlwdHMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIkKGZ1bmN0aW9uKCkge1xuXG4gIHZhciBtZWRpYUVsZSA9IG51bGw7XG5cbiAgLyoqXG4gICAqIEluaXRpYWxpemUgZm91bmRhdGlvblxuICAgKi9cbiAgJChkb2N1bWVudCkuZm91bmRhdGlvbigpO1xuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplIHNsaWRlclxuICAgKi9cbiAgJCgnLnNjcmVlblRleHQnKS5zbGljayh7XG4gICAgZG90czogdHJ1ZSxcbiAgICBpbmZpbml0ZTogdHJ1ZSxcbiAgICBzcGVlZDogNTAwLFxuICAgIGZhZGU6IHRydWUsXG4gICAgY3NzRWFzZTogJ2xpbmVhcidcbiAgfSk7XG5cbiAgLyoqXG4gICAqIEluaXRpYWxpemUgYXVkaW8gcGxheWVyXG4gICAqL1xuICBpZiAod2luZG93LmxvY2F0aW9uLnBhdGhuYW1lLmluZGV4T2YoJ3BsYXknKSkge1xuICAgICQoJyNhdWRpb1BsYXllcicpLm1lZGlhZWxlbWVudHBsYXllcih7XG4gICAgICBzdHJldGNoaW5nOiAncmVzcG9uc2l2ZScsXG4gICAgICBwbHVnaW5QYXRoOiAnLi4vanMvbGliL2J1aWxkLycsXG4gICAgICAvLyBXaGVuIHVzaW5nIGpRdWVyeSdzIGBtZWRpYWVsZW1lbnRwbGF5ZXJgLCBhbiBgaW5zdGFuY2VgIGFyZ3VtZW50XG4gICAgICAvLyBpcyBhdmFpbGFibGUgaW4gdGhlIGBzdWNjZXNzYCBjYWxsYmFja1xuICAgICAgc3VjY2VzczogZnVuY3Rpb24obWVkaWFFbGVtZW50LCBvcmlnaW5hbE5vZGUsIGluc3RhbmNlKSB7XG4gICAgICAgIG1lZGlhRWxlID0gbWVkaWFFbGVtZW50O1xuICAgICAgICBoaWdoTGlnaHRQcmV2TmV4dCgpO1xuXG4gICAgICAgIC8vbWVkaWFFbGUucGxheSgpO1xuICAgICAgICAkKG1lZGlhRWxlbWVudCkub24oJ2VuZGVkJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYgKCQoJyN0cmFja1NodWZmbGUnKS5oYXNDbGFzcygnYWN0aXZlJykpIHtcbiAgICAgICAgICAgIGNvbnN0IGxpQ291bnQgPSAkKCdsaS50cmFja0xpc3QnKS5sZW5ndGg7XG4gICAgICAgICAgICBjb25zdCByYW5kb20gPSBNYXRoLmZsb29yKChNYXRoLnJhbmRvbSgpICogbGlDb3VudCkgKyAxKTtcbiAgICAgICAgICAgIHZhciBsaUVsZSA9ICQoJ2xpLnRyYWNrTGlzdDpudGgtY2hpbGQoJyArIHJhbmRvbSArICcpJyk7XG5cblxuICAgICAgICAgICAgaWYgKGxpRWxlLmhhc0NsYXNzKCdoaWdobGlnaHQnKSkge1xuICAgICAgICAgICAgICBsaUVsZSA9IGxpRWxlLm5leHQoKTtcbiAgICAgICAgICAgICAgaWYgKGxpRWxlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGxpRWxlID0gJCgnbGkudHJhY2tMaXN0Om50aC1jaGlsZCgxKScpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxpRWxlLmNsaWNrKCk7XG4gICAgICAgICAgICBoaWdoTGlnaHRQcmV2TmV4dCgpO1xuXG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciBsaUVsZSA9ICQoJ2xpLnRyYWNrTGlzdC5oaWdobGlnaHQnKS5uZXh0KCk7XG4gICAgICAgICAgICBpZiAoJCgnI3RyYWNrUmVwZWF0JykuaGFzQ2xhc3MoJ2FjdGl2ZScpKSB7XG4gICAgICAgICAgICAgIG1lZGlhRWxlbWVudC5wbGF5KCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBpZiAobGlFbGUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgY2FsbEZvY3VzKCQoJ2xpLnRyYWNrTGlzdCcpLmZpcnN0KCkpO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGxpRWxlLmNsaWNrKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGhpZ2hMaWdodFByZXZOZXh0KCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgICBlcnJvcjogZnVuY3Rpb24obWVkaWFFbGVtZW50LCBvcmlnaW5hbE5vZGUpIHtcbiAgICAgICAgYWxlcnQoJ1RoZXJlIGlzIHNvbWUgZXJyb3IgYXQgdGhlIHNlcnZlciBwbGF5aW5nIHRoZSB0cmFjayEnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNodWZmbGVUcmFja3MoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBpZiAoISQodGhpcykuaGFzQ2xhc3MoJ2luYWN0aXZlJykpIHtcbiAgICAgICQodGhpcykudG9nZ2xlQ2xhc3MoJ2FjdGl2ZScpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXlQcmV2aW91cyhlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGlmICghJCh0aGlzKS5oYXNDbGFzcygnaW5hY3RpdmUnKSkge1xuICAgICAgdmFyIGxpRWxlID0gJCgnbGkudHJhY2tMaXN0LmhpZ2hsaWdodCcpLnByZXYoKTtcbiAgICAgIGxpRWxlLmNsaWNrKCk7XG4gICAgICBoaWdoTGlnaHRQcmV2TmV4dCgpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXlOZXh0KGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgaWYgKCEkKHRoaXMpLmhhc0NsYXNzKCdpbmFjdGl2ZScpKSB7XG4gICAgICB2YXIgbGlFbGUgPSAkKCdsaS50cmFja0xpc3QuaGlnaGxpZ2h0JykubmV4dCgpO1xuICAgICAgbGlFbGUuY2xpY2soKTtcbiAgICAgIGhpZ2hMaWdodFByZXZOZXh0KCk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gaGlnaExpZ2h0UHJldk5leHQoKSB7XG4gICAgaWYgKCQoJ2xpLnRyYWNrTGlzdC5oaWdobGlnaHQnKS5wcmV2KCkubGVuZ3RoID09PSAwKSB7XG4gICAgICAkKCcjdHJhY2tQcmV2JykuYWRkQ2xhc3MoJ2luYWN0aXZlJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgICQoJyN0cmFja1ByZXYnKS5yZW1vdmVDbGFzcygnaW5hY3RpdmUnKTtcbiAgICB9XG4gICAgaWYgKCQoJ2xpLnRyYWNrTGlzdC5oaWdobGlnaHQnKS5uZXh0KCkubGVuZ3RoID09PSAwKSB7XG4gICAgICAkKCcjdHJhY2tOZXh0JykuYWRkQ2xhc3MoJ2luYWN0aXZlJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgICQoJyN0cmFja05leHQnKS5yZW1vdmVDbGFzcygnaW5hY3RpdmUnKTtcbiAgICB9XG5cbiAgICBpZiAoJCgnbGkudHJhY2tMaXN0LmhpZ2hsaWdodCcpLnByZXYoKS5sZW5ndGggPT09IDAgJiYgJCgnbGkudHJhY2tMaXN0LmhpZ2hsaWdodCcpLm5leHQoKS5sZW5ndGggPT09IDApIHtcbiAgICAgICQoJyN0cmFja1NodWZmbGUnKS5hZGRDbGFzcygnaW5hY3RpdmUnKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBjYWxsRm9jdXMobGlFbGUpIHtcbiAgICAkKCcudHJhY2tMaXN0JykucmVtb3ZlQ2xhc3MoJ2hpZ2hsaWdodCcpO1xuICAgICQoJy50cmFja0l0ZW0nKS5yZW1vdmVDbGFzcygnZmktc291bmQnKTtcbiAgICBsaUVsZS5hZGRDbGFzcygnaGlnaGxpZ2h0Jyk7XG4gICAgbGlFbGUuZmluZCgnLnRyYWNrSXRlbScpLmFkZENsYXNzKCdmaS1zb3VuZCcpO1xuICAgIGNvbnN0IHRyYWNrU3JjID0gbGlFbGUuZGF0YSgndHJhY2stc3JjJyk7XG4gICAgLy8gY29uc3Qgc3RyID0gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lO1xuICAgIC8vIGNvbnN0IHBhdGggPSBzdHIuc3Vic3RyKDAsIHN0ci5sYXN0SW5kZXhPZihcIi9cIikgKyAxKTtcbiAgICAvLyBjb25zdCB0cmFja0lkID0gbGlFbGUuYXR0cignaWQnKTtcbiAgICBtZWRpYUVsZS5zZXRTcmModHJhY2tTcmMpO1xuICAgIG1lZGlhRWxlLmxvYWQoKTtcbiAgICAvL2hpc3RvcnkucHVzaFN0YXRlKHRyYWNrSWQsICcnLCBwYXRoICsgdHJhY2tJZCk7XG4gIH1cblxuICAvKipcbiAgICogUmVnaXN0ZXIgZnVuY3Rpb25zXG4gICAqL1xuICAkKHdpbmRvdykub24oJ2xvYWQgcmVzaXplJywgaGFuZGxlTG9hZCk7XG4gICQoJyNsb2dpbicpLm9uKCdzdWJtaXQnLCBoYW5kbGVMb2dpbik7IC8qIG9uIGxvZ2luICovXG4gICQoJyNlZGl0UHJvZmlsZScpLm9uKCdzdWJtaXQnLCBoYW5kbGVVcGRhdGVQcm9maWxlKTsgLyogdXBkYXRlIHByb2ZpbGUgKi9cbiAgJCgnI2NvbmZpcm1Vc2VyJykub24oJ3N1Ym1pdCcsIGhhbmRsZVZlcmlmeVVzZXIpOyAvKiB2ZXJpZnkgdXNlciAqL1xuICAkKCcjZm9yZ290UGFzc3dvcmQnKS5vbignc3VibWl0JywgaGFuZGxlVXBkYXRlUGFzc3dvcmQpOyAvKiBwb3N0IHVwZGF0ZSBwYXNzd29yZCAqL1xuICAkKCcjc2lnbnVwJykub24oJ3N1Ym1pdCcsIGhhbmRsZVNpZ25VcCk7IC8qIFNpZ24gdXAgKi9cbiAgJCgnI3Jlc2V0Jykub24oJ2NsaWNrJywgY2xlYXJNZXNzYWdlKTsgLyogQ2xlYXIgbWVzc2FnZXMgb24gY2xpY2sgb2YgcmVzZXQgKi9cbiAgJCgnI2NoYW5nZVBhc3N3b3JkJykub24oJ3N1Ym1pdCcsIGhhbmRsZUNoYW5nZVBhc3N3b3JkKTsgLyogcG9zdCBjaGFuZ2UgcGFzc3dvcmQgKi9cbiAgJCgnI3NlYXJjaEljb24nKS5vbignY2xpY2snLCBkaXNwbGF5U2VhcmNoQmFyKTtcbiAgJCgnLmpzLXNlYXJjaC1jbG9zZScpLm9uKCdjbGljaycsIGhpZGVTZWFyY2hCYXIpO1xuICAkKCcubWVudURpdicpLm9uKCdjbGljaycsIHNob3dVc2VyTWVudUQpO1xuICAkKCcudHJhY2tMaXN0Jykub24oJ2NsaWNrJywgY2hhbmdlVHJhY2spOyAvKiBjaGFuZ2UgdHJhY2sgb24gY2xpY2sgKi9cbiAgJCgnI3NlYXJjaC10ZXh0Jykub24oJ2tleXVwJywgY2FsbFNlYXJjaCk7IC8qIHNlYXJjaCBmdW5jdGlvbmFsaXR5ICovXG4gICQoJy5qcy1zZWFyY2gtaWNvbicpLm9uKCdjbGljaycsIHNlYXJjaCk7IC8qIHNlYXJjaCBmdW5jdGlvbmFsaXR5ICovXG4gICQoJyN0cmFja1JlcGVhdCcpLm9uKCdjbGljaycsIGxpbmtBY3RpdmUpO1xuICAkKCcjdHJhY2tMaWtlJykub24oJ2NsaWNrJywgbGlua0FjdGl2ZSk7XG4gICQoJyN0cmFja1ByZXYnKS5vbignY2xpY2snLCBwbGF5UHJldmlvdXMpOyAvKiBwbGF5IHByZXZpb3VzIHRyYWNrICovXG4gICQoJyN0cmFja05leHQnKS5vbignY2xpY2snLCBwbGF5TmV4dCk7IC8qIHBsYXkgbmV4dCB0cmFjayAqL1xuICAkKCcjdHJhY2tTaHVmZmxlJykub24oJ2NsaWNrJywgc2h1ZmZsZVRyYWNrcyk7IC8qIHNodWZmbGUgdHJhY2tzKi9cbiAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5tZW51TW9kZScsIHNob3dVc2VyTWVudSk7XG4gICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuY2xvc2UtaWNvbicsIGhpZGVVc2VyTWVudSk7XG4gICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuc2VlQWxsUicsIHNlZUFsbFJlc3VsdHMpOyAvKiBzZWUgYWxsIHRoZSB0cmFja3Mgb2Ygc2VhcmNoIHJlc3VsdHMgKi9cblxuXG4gIHZhciB1c2VyID0gbnVsbDtcblxuXG4gIC8qIGZ1bmN0aW9ucyAqL1xuICBmdW5jdGlvbiBoYW5kbGVMb2FkKCkge1xuICAgIGNvbnN0IGZvb3RlciA9ICQoJyNmb290ZXInKTtcbiAgICBpZiAoJCgnLnRpdGxlLWJhcicpLmlzKCc6dmlzaWJsZScpKSB7XG4gICAgICAkKCcjaW5kZXgtbWVudScpLnJlbW92ZUNsYXNzKCdhZGRGbG9hdCcpO1xuICAgIH0gZWxzZSB7XG4gICAgICAkKCcjaW5kZXgtbWVudScpLmFkZENsYXNzKCdhZGRGbG9hdCcpO1xuICAgIH1cbiAgICB2YXIgd2lkdGggPSAkKHdpbmRvdykud2lkdGgoKTtcbiAgICBpZiAod2lkdGggPCA0MDApIHtcbiAgICAgICQoJy5tZW51RGl2JykuYWRkQ2xhc3MoJ21lbnVNb2RlJyk7XG4gICAgICAkKCcjdXNlci1tZW51JykucmVtb3ZlQ2xhc3MoJ3Nob3cnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgJCgnI3VzZXItbWVudScpLnJlbW92ZUNsYXNzKCdzaG93Jyk7XG4gICAgICAkKCcjdXNlci1tZW51JykuY3NzKCd3aWR0aCcsICcxODBweCcpO1xuICAgICAgJCgnLmNsb3NlLWljb24nKS5yZW1vdmUoKTtcbiAgICAgICQoJy5tZW51RGl2JykucmVtb3ZlQ2xhc3MoJ21lbnVNb2RlJyk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gaGFuZGxlTG9naW4oZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBjbGVhck1lc3NhZ2UoKTtcbiAgICBjb25zdCBuYW1lID0gJCgnI3VzZXJOYW1lJykudmFsKCk7XG4gICAgY29uc3QgcHdkID0gJCgnI3VzZXJQYXNzd29yZCcpLnZhbCgpO1xuXG4gICAgaWYgKG5hbWUubGVuZ3RoICE9PSAwICYmIHB3ZC5sZW5ndGggIT09IDApIHtcbiAgICAgIGNvbnN0IHVzZXJOYW1lUmVnZXggPSAvXlthLXpBLVowLTkuX117MSwzMH0kLztcbiAgICAgIGNvbnN0IG5hbWVWZXJpZmllcyA9IHVzZXJOYW1lUmVnZXgudGVzdChuYW1lKTtcblxuICAgICAgaWYgKG5hbWVWZXJpZmllcykge1xuICAgICAgICAkLnBvc3QoJy9sb2dpbicsIHtcbiAgICAgICAgICAgIHVzZXJuYW1lOiBuYW1lLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IHB3ZFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZhaWwoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2VUZXh0ID0gZGF0YS5yZXNwb25zZUpTT047XG4gICAgICAgICAgICBpZiAoZGF0YS5zdGF0dXMgPT09IDQwMCkge1xuICAgICAgICAgICAgICBzaG93TWVzc2FnZShyZXNwb25zZVRleHRbMF0ubXNnLCAnZXJyb3InKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChkYXRhLnN0YXR1cyA9PT0gNDAxKSB7XG4gICAgICAgICAgICAgIHNob3dNZXNzYWdlKHJlc3BvbnNlVGV4dC5tc2csICdlcnJvcicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmRvbmUoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSAnL3VzZXIvaG9tZSc7XG4gICAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzaG93RXJyb3JDaXJjbGUoJ3VzZXJOYW1lJyk7XG4gICAgICAgIHNob3dNZXNzYWdlKCdVc2VybmFtZXMgY2FuIG9ubHkgdXNlIGxldHRlcnMsIG51bWJlcnMsIHVuZGVyc2NvcmVzIGFuZCBwZXJpb2RzLicsICdlcnJvcicpO1xuXG4gICAgICB9XG4gICAgfSBlbHNlIHtcblxuICAgICAgaWYgKG5hbWUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHNob3dFcnJvckNpcmNsZSgndXNlck5hbWUnKTtcbiAgICAgICAgJCgnI2VtcHR5RmllbGRzJykucmVtb3ZlQ2xhc3MoJ2hpZGUnKTtcbiAgICAgIH1cbiAgICAgIGlmIChwd2QubGVuZ3RoID09IDApIHtcbiAgICAgICAgc2hvd0Vycm9yQ2lyY2xlKCd1c2VyUGFzc3dvcmQnKTtcbiAgICAgICAgJCgnI2VtcHR5RmllbGRzJykucmVtb3ZlQ2xhc3MoJ2hpZGUnKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBoYW5kbGVVcGRhdGVQcm9maWxlKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICBjbGVhck1lc3NhZ2UoKTtcblxuICAgIGNvbnN0IHVzZXJuYW1lID0gJCgnI3VzZXJOYW1lJykudmFsKCk7XG4gICAgY29uc3QgZW1haWwgPSAkKCcjZW1haWwnKS52YWwoKTtcblxuICAgIGlmICh1c2VybmFtZS5sZW5ndGggIT09IDAgJiYgZW1haWwubGVuZ3RoICE9PSAwKSB7XG5cbiAgICAgIGNvbnN0IHBhdHRlcm4gPSAvXlthLXpBLVowLTkuX117MSwzMH0kLztcbiAgICAgIGNvbnN0IG5hbWVWZXJpZmllcyA9IHBhdHRlcm4udGVzdCh1c2VybmFtZSk7XG4gICAgICBpZiAobmFtZVZlcmlmaWVzKSB7XG4gICAgICAgICQucG9zdCgnL3VzZXIvZWRpdFByb2ZpbGUnLCB7XG4gICAgICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUsXG4gICAgICAgICAgICBlbWFpbDogZW1haWxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5mYWlsKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhLnN0YXR1cyA9PT0gNDAwKSB7XG4gICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlVGV4dCA9IGRhdGEucmVzcG9uc2VKU09OO1xuICAgICAgICAgICAgICBpZiAocmVzcG9uc2VUZXh0Lmxlbmd0aCA+PSAxKSB7XG4gICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UocmVzcG9uc2VUZXh0WzBdLm1zZywgJ2Vycm9yJyk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UocmVzcG9uc2VUZXh0Lm1zZywgJ2Vycm9yJyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICAgIC5kb25lKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgIHNob3dNZXNzYWdlKGRhdGEubXNnLCAnbXNnJyk7XG4gICAgICAgICAgICAkKCcjbG9naW5MaW5rJykucmVtb3ZlQ2xhc3MoJ2hpZGUnKTtcbiAgICAgICAgICAgICQoJy5idG5zJykuYWRkQ2xhc3MoJ2hpZGUnKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNob3dFcnJvckNpcmNsZSgndXNlck5hbWUnKTtcbiAgICAgICAgc2hvd01lc3NhZ2UoJ1VzZXJuYW1lcyBjYW4gb25seSB1c2UgbGV0dGVycywgbnVtYmVycywgdW5kZXJzY29yZXMgYW5kIHBlcmlvZHMuJywgJ2Vycm9yJyk7XG5cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHVzZXJuYW1lLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBzaG93RXJyb3JDaXJjbGUoJ3VzZXJOYW1lJyk7XG4gICAgICAgICQoJyNlbXB0eUZpZWxkcycpLnJlbW92ZUNsYXNzKCdoaWRlJyk7XG4gICAgICB9XG4gICAgICBpZiAoZW1haWwubGVuZ3RoID09IDApIHtcbiAgICAgICAgc2hvd0Vycm9yQ2lyY2xlKCdlbWFpbCcpO1xuICAgICAgICAkKCcjZW1wdHlGaWVsZHMnKS5yZW1vdmVDbGFzcygnaGlkZScpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGhhbmRsZVZlcmlmeVVzZXIoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgIGNsZWFyTWVzc2FnZSgpO1xuXG4gICAgY29uc3QgdXNlcm5hbWUgPSAkKCcjdXNlcm5hbWUnKS52YWwoKTtcblxuICAgIGlmICh1c2VybmFtZS5sZW5ndGggIT09IDApIHtcblxuICAgICAgJC5wb3N0KCcvdmVyaWZ5VXNlcicsIHtcbiAgICAgICAgICB1c2VybmFtZTogdXNlcm5hbWVcbiAgICAgICAgfSlcbiAgICAgICAgLmZhaWwoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgIGlmIChkYXRhLnN0YXR1cyA9PT0gNDAxKSB7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZVRleHQgPSBkYXRhLnJlc3BvbnNlSlNPTjtcbiAgICAgICAgICAgIHNob3dNZXNzYWdlKHJlc3BvbnNlVGV4dC5tc2csICdlcnJvcicpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgLmRvbmUoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICQoJyN1c2VybmFtZScpLnZhbCgnJyk7XG4gICAgICAgICAgJCgnI2ZvcmdvdFBhc3N3b3JkJykucmVtb3ZlQ2xhc3MoJ2hpZGUnKTtcbiAgICAgICAgICAkKCcjY29uZmlybVVzZXInKS5hZGRDbGFzcygnaGlkZScpO1xuICAgICAgICAgIHVzZXIgPSBkYXRhO1xuICAgICAgICB9KTtcblxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAodXNlcm5hbWUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHNob3dFcnJvckNpcmNsZSgndXNlcm5hbWUnKTtcbiAgICAgICAgJCgnI2VtcHR5RmllbGRzJykucmVtb3ZlQ2xhc3MoJ2hpZGUnKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBoYW5kbGVVcGRhdGVQYXNzd29yZChlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGNsZWFyTWVzc2FnZSgpO1xuXG4gICAgY29uc3QgbmV3UHdkID0gJCgnI25ld1Bhc3N3b3JkJykudmFsKCk7XG4gICAgY29uc3QgY29uZmlybVB3ZCA9ICQoJyNjb25maXJtUGFzc3dvcmQnKS52YWwoKTtcblxuICAgIGlmIChuZXdQd2QubGVuZ3RoID09PSAwKSB7XG4gICAgICBzaG93RXJyb3JDaXJjbGUoJ25ld1Bhc3N3b3JkJyk7XG4gICAgICAkKCcjZW1wdHlGaWVsZHMnKS5yZW1vdmVDbGFzcygnaGlkZScpO1xuICAgIH1cblxuICAgIGlmIChjb25maXJtUHdkLmxlbmd0aCA9PT0gMCkge1xuICAgICAgc2hvd0Vycm9yQ2lyY2xlKCdjb25maXJtUGFzc3dvcmQnKTtcbiAgICAgICQoJyNlbXB0eUZpZWxkcycpLnJlbW92ZUNsYXNzKCdoaWRlJyk7XG4gICAgfVxuXG4gICAgaWYgKG5ld1B3ZC5sZW5ndGggIT09IDAgJiYgY29uZmlybVB3ZCAhPT0gbmV3UHdkKSB7XG4gICAgICBzaG93RXJyb3JDaXJjbGUoJ2NvbmZpcm1QYXNzd29yZCcpO1xuICAgICAgJCgnI2VtcHR5RmllbGRzJykuYWRkQ2xhc3MoJ2hpZGUnKTtcbiAgICAgIHNob3dNZXNzYWdlKCdDb25maXJtIHBhc3N3b3JkIGRvZXNuXFwndCBtYXRjaCB3aXRoIHRoZSBuZXcgcGFzc3dvcmQnLCAnZXJyb3InKTtcbiAgICB9XG5cbiAgICBpZiAobmV3UHdkLmxlbmd0aCAhPT0gMCAmJiBjb25maXJtUHdkLmxlbmd0aCAhPT0gMCAmJiBuZXdQd2QgPT09IGNvbmZpcm1Qd2QpIHtcbiAgICAgICQucG9zdCgnL2ZvcmdvdFBhc3N3b3JkJywge1xuICAgICAgICAgIG5ld1Bhc3N3b3JkOiBuZXdQd2QsXG4gICAgICAgICAgdXNlcjogdXNlclxuICAgICAgICB9KVxuICAgICAgICAuZmFpbChmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgaWYgKGRhdGEuc3RhdHVzID09PSA0MDApIHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlVGV4dCA9IGRhdGEucmVzcG9uc2VKU09OO1xuICAgICAgICAgICAgc2hvd01lc3NhZ2UocmVzcG9uc2VUZXh0Lm1zZywgJ2Vycm9yJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICAuZG9uZShmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgc2hvd01lc3NhZ2UoZGF0YS5tc2csICdtc2cnKTtcbiAgICAgICAgICAkKCcuYnRucycpLmFkZENsYXNzKCdoaWRlJyk7XG4gICAgICAgICAgJCgnI2xvZ2luTGluaycpLnJlbW92ZUNsYXNzKCdoaWRlJyk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGhhbmRsZUNoYW5nZVBhc3N3b3JkKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgY2xlYXJNZXNzYWdlKCk7XG5cbiAgICBjb25zdCBvbGRQd2QgPSAkKCcjb2xkUGFzc3dvcmQnKS52YWwoKTtcbiAgICBjb25zdCBuZXdQd2QgPSAkKCcjbmV3UGFzc3dvcmQnKS52YWwoKTtcbiAgICBjb25zdCBjb25maXJtUHdkID0gJCgnI2NvbmZpcm1QYXNzd29yZCcpLnZhbCgpO1xuXG4gICAgaWYgKG9sZFB3ZC5sZW5ndGggPT09IDApIHtcbiAgICAgIHNob3dFcnJvckNpcmNsZSgnb2xkUGFzc3dvcmQnKTtcbiAgICAgICQoJyNlbXB0eUZpZWxkcycpLnJlbW92ZUNsYXNzKCdoaWRlJyk7XG4gICAgfVxuXG4gICAgaWYgKG5ld1B3ZC5sZW5ndGggPT09IDApIHtcbiAgICAgIHNob3dFcnJvckNpcmNsZSgnbmV3UGFzc3dvcmQnKTtcbiAgICAgICQoJyNlbXB0eUZpZWxkcycpLnJlbW92ZUNsYXNzKCdoaWRlJyk7XG4gICAgfVxuXG4gICAgaWYgKGNvbmZpcm1Qd2QubGVuZ3RoID09PSAwKSB7XG4gICAgICBzaG93RXJyb3JDaXJjbGUoJ2NvbmZpcm1QYXNzd29yZCcpO1xuICAgICAgJCgnI2VtcHR5RmllbGRzJykucmVtb3ZlQ2xhc3MoJ2hpZGUnKTtcbiAgICB9XG5cbiAgICBpZiAobmV3UHdkLmxlbmd0aCAhPT0gMCAmJiBjb25maXJtUHdkLmxlbmd0aCAhPT0gMCAmJiBjb25maXJtUHdkICE9PSBuZXdQd2QpIHtcbiAgICAgIHNob3dFcnJvckNpcmNsZSgnY29uZmlybVBhc3N3b3JkJyk7XG4gICAgICAkKCcjZW1wdHlGaWVsZHMnKS5hZGRDbGFzcygnaGlkZScpO1xuICAgICAgc2hvd01lc3NhZ2UoJ0NvbmZpcm0gcGFzc3dvcmQgZG9lc25cXCd0IG1hdGNoIHdpdGggdGhlIG5ldyBwYXNzd29yZCcsICdlcnJvcicpO1xuICAgICAgaWYgKG9sZFB3ZC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgJCgnI2VtcHR5RmllbGRzJykucmVtb3ZlQ2xhc3MoJ2hpZGUnKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAob2xkUHdkLmxlbmd0aCAhPT0gMCAmJiBuZXdQd2QubGVuZ3RoICE9PSAwICYmIGNvbmZpcm1Qd2QubGVuZ3RoICE9PSAwICYmIG5ld1B3ZCA9PT0gY29uZmlybVB3ZCkge1xuICAgICAgJC5wb3N0KCcvdXNlci9jaGFuZ2VQYXNzd29yZCcsIHtcbiAgICAgICAgICBvbGRQYXNzd29yZDogb2xkUHdkLFxuICAgICAgICAgIG5ld1Bhc3N3b3JkOiBuZXdQd2RcbiAgICAgICAgfSlcbiAgICAgICAgLmZhaWwoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgIGlmIChkYXRhLnN0YXR1cyA9PT0gNDAwKSB7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZVRleHQgPSBkYXRhLnJlc3BvbnNlSlNPTjtcbiAgICAgICAgICAgIHNob3dNZXNzYWdlKHJlc3BvbnNlVGV4dC5tc2csICdlcnJvcicpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgLmRvbmUoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgIHNob3dNZXNzYWdlKGRhdGEubXNnLCAnbXNnJyk7XG4gICAgICAgICAgJCgnLmJ0bnMnKS5hZGRDbGFzcygnaGlkZScpO1xuICAgICAgICAgICQoJyNsb2dpbkxpbmsnKS5yZW1vdmVDbGFzcygnaGlkZScpO1xuICAgICAgICB9KTtcbiAgICB9XG5cblxuXG4gIH1cblxuICBmdW5jdGlvbiBoYW5kbGVTaWduVXAoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBjbGVhck1lc3NhZ2UoKTtcblxuICAgIGNvbnN0IG5hbWUgPSAkKFwiI3VzZXJOYW1lXCIpLnZhbCgpO1xuICAgIGNvbnN0IGVtYWlsID0gJChcIiN1c2VyRW1haWxcIikudmFsKCk7XG4gICAgY29uc3QgcHdkID0gJChcIiN1c2VyUGFzc3dvcmRcIikudmFsKCk7XG4gICAgY29uc3QgY29uZmlybXB3ZCA9ICQoXCIjY29uZmlybVBhc3N3b3JkXCIpLnZhbCgpO1xuICAgIGNvbnN0IHVzZXJOYW1lUmVnZXggPSAvXlthLXpBLVowLTkuX117MSwzMH0kLztcbiAgICBjb25zdCBuYW1lVmVyaWZpZXMgPSB1c2VyTmFtZVJlZ2V4LnRlc3QobmFtZSk7XG5cblxuICAgIGlmIChuYW1lLmxlbmd0aCA9PT0gMCkge1xuICAgICAgc2hvd0Vycm9yQ2lyY2xlKCd1c2VyTmFtZScpO1xuICAgICAgJCgnI2VtcHR5RmllbGRzJykucmVtb3ZlQ2xhc3MoJ2hpZGUnKTtcbiAgICB9XG5cbiAgICBpZiAoIW5hbWVWZXJpZmllcyAmJiBuYW1lLmxlbmd0aCAhPT0gMCkge1xuICAgICAgc2hvd0Vycm9yQ2lyY2xlKCd1c2VyTmFtZScpO1xuICAgICAgc2hvd01lc3NhZ2UoJ1VzZXJuYW1lcyBjYW4gb25seSB1c2UgbGV0dGVycywgbnVtYmVycywgdW5kZXJzY29yZXMgYW5kIHBlcmlvZHMuJywgJ2Vycm9yJyk7XG4gICAgfVxuXG4gICAgaWYgKGVtYWlsLmxlbmd0aCA9PT0gMCkge1xuICAgICAgc2hvd0Vycm9yQ2lyY2xlKCd1c2VyRW1haWwnKTtcbiAgICAgICQoJyNlbXB0eUZpZWxkcycpLnJlbW92ZUNsYXNzKCdoaWRlJyk7XG4gICAgfVxuXG4gICAgaWYgKHB3ZC5sZW5ndGggPT09IDApIHtcbiAgICAgIHNob3dFcnJvckNpcmNsZSgndXNlclBhc3N3b3JkJyk7XG4gICAgICAkKCcjZW1wdHlGaWVsZHMnKS5yZW1vdmVDbGFzcygnaGlkZScpO1xuICAgIH1cblxuICAgIGlmIChjb25maXJtcHdkLmxlbmd0aCA9PT0gMCkge1xuICAgICAgc2hvd0Vycm9yQ2lyY2xlKCdjb25maXJtUGFzc3dvcmQnKTtcbiAgICAgICQoJyNlbXB0eUZpZWxkcycpLnJlbW92ZUNsYXNzKCdoaWRlJyk7XG4gICAgfVxuXG4gICAgaWYgKHB3ZC5sZW5ndGggIT09IDAgJiYgY29uZmlybXB3ZC5sZW5ndGggIT09IDAgJiYgY29uZmlybXB3ZCAhPT0gcHdkKSB7XG4gICAgICBzaG93RXJyb3JDaXJjbGUoJ2NvbmZpcm1QYXNzd29yZCcpO1xuICAgICAgJCgnI2VtcHR5RmllbGRzJykuYWRkQ2xhc3MoJ2hpZGUnKTtcbiAgICAgIHNob3dNZXNzYWdlKCdDb25maXJtIHBhc3N3b3JkIGRvZXNuXFwndCBtYXRjaCB3aXRoIHBhc3N3b3JkJywgJ2Vycm9yJyk7XG4gICAgICBpZiAoZW1haWwubGVuZ3RoID09PSAwIHx8IG5hbWUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICQoJyNlbXB0eUZpZWxkcycpLnJlbW92ZUNsYXNzKCdoaWRlJyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gY29uc3QgZXJyb3IgPSAnVXNlcm5hbWVzIGNhbiBvbmx5IHVzZSBsZXR0ZXJzLCBudW1iZXJzLCB1bmRlcnNjb3JlcyBhbmQgcGVyaW9kcy4nO1xuICAgIC8vIGNvbnN0IG5hbWUgPSAnT0xJVkUnO1xuICAgIC8vIGNvbnN0IHB3ZCA9ICdPTElWRSc7XG4gICAgLy8gY29uc3QgZW1haWwgPSAnZ2VldGFAZ21haWwuY29tJztcbiAgICBpZiAobmFtZS5sZW5ndGggIT09IDAgJiYgcHdkLmxlbmd0aCAhPT0gMCAmJiBjb25maXJtcHdkLmxlbmd0aCAhPT0gMCAmJlxuICAgICAgZW1haWwubGVuZ3RoICE9PSAwICYmIHB3ZCA9PT0gY29uZmlybXB3ZCAmJiBuYW1lVmVyaWZpZXMpIHtcbiAgICAgICQucG9zdCgnL3NpZ251cCcsIHtcbiAgICAgICAgICB1c2VybmFtZTogbmFtZSxcbiAgICAgICAgICBwYXNzd29yZDogcHdkLFxuICAgICAgICAgIGVtYWlsOiBlbWFpbFxuICAgICAgICB9KVxuICAgICAgICAuZmFpbChmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgaWYgKGRhdGEuc3RhdHVzID09PSA0MDApIHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlVGV4dCA9IGRhdGEucmVzcG9uc2VKU09OO1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlVGV4dC5sZW5ndGggPj0gMSkge1xuICAgICAgICAgICAgICBzaG93TWVzc2FnZShyZXNwb25zZVRleHRbMF0ubXNnLCAnZXJyb3InKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHNob3dNZXNzYWdlKHJlc3BvbnNlVGV4dC5tc2csICdlcnJvcicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgLmRvbmUoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgIHNob3dNZXNzYWdlKGRhdGEubXNnLCAnbXNnJyk7XG4gICAgICAgICAgJCgnLmJ0bnMnKS5hZGRDbGFzcygnaGlkZScpO1xuICAgICAgICAgICQoJyNsb2dpbkxpbmsnKS5yZW1vdmVDbGFzcygnaGlkZScpO1xuICAgICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBkaXNwbGF5U2VhcmNoQmFyKGUpIHtcbiAgICBpZiAoZSkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH1cblxuICAgICQoJyNoZWFkZXJEaXYnKS5yZW1vdmVDbGFzcygnc2hvdycpLmFkZENsYXNzKCdoaWRlJyk7XG4gICAgJCgnI3NlYXJjaCcpLmFkZENsYXNzKCdzaG93Jyk7XG5cbiAgICAvKiBoaWRlIHJlc3Qgb2YgZGF0YSBmb3Igc2VhcmNoIHZpZXcgKi9cbiAgICAkKCcuanMtbm9uU2VhcmNoVmlldycpLmFkZENsYXNzKCdoaWRlJyk7XG4gICAgJCgnLmpzLXNlYXJjaFZpZXcnKS5yZW1vdmVDbGFzcygnaGlkZScpO1xuICB9XG5cbiAgZnVuY3Rpb24gaGlkZVNlYXJjaEJhcihlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICQoJyNzZWFyY2gtdGV4dCcpLnZhbCgnJyk7XG4gICAgJCgnI2hlYWRlckRpdicpLnJlbW92ZUNsYXNzKCdoaWRlJykuYWRkQ2xhc3MoJ3Nob3cnKTtcbiAgICAkKCcjc2VhcmNoJykucmVtb3ZlQ2xhc3MoJ3Nob3cnKTtcblxuICAgIC8qIHNob3cgcmVzdCBvZiBkYXRhIGFuZCBoaWRlIHNlYXJjaCB2aWV3Ki9cbiAgICAkKCcuanMtbm9uU2VhcmNoVmlldycpLnJlbW92ZUNsYXNzKCdoaWRlJyk7XG4gICAgJCgnLmpzLXNlYXJjaFZpZXcnKS5hZGRDbGFzcygnaGlkZScpO1xuICAgIC8vJCgnLmpzLXNlYXJjaFZpZXcnKS5lbXB0eSgpO1xuICAgIGlmICh3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUuaW5kZXhPZigndXNlcicpID09PSAtMSkge1xuICAgICAgd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lID0gJy91c2VyL2hvbWUnO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHNob3dVc2VyTWVudUQoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBjb25zdCB1c2VySWNvbiA9ICQoJyN1c2VyLW1lbnUnKTtcbiAgICBpZiAoIXVzZXJJY29uLmhhc0NsYXNzKCdzaG93JykpIHtcbiAgICAgICQoJyN1c2VyLW1lbnUnKS5hZGRDbGFzcygnc2hvdycpO1xuICAgIH0gZWxzZSB7XG4gICAgICAkKCcjdXNlci1tZW51JykucmVtb3ZlQ2xhc3MoJ3Nob3cnKTtcbiAgICB9XG5cbiAgfVxuXG4gIGZ1bmN0aW9uIHNob3dVc2VyTWVudShlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGNvbnN0IHVzZXJJY29uID0gJCgnI3VzZXItbWVudScpO1xuICAgICQoJyN1c2VyLW1lbnUnKS5hZGRDbGFzcygnc2hvdycpO1xuICAgIHVzZXJJY29uLmNzcygnd2lkdGgnLCAnMjUwcHgnKTtcbiAgICB1c2VySWNvbi5wcmVwZW5kKCc8ZGl2IGNsYXNzPVwiY2xvc2UtaWNvblwiPjxpIGNsYXNzPVwiZmkteFwiPjwvaT48L2Rpdj4nKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGhpZGVVc2VyTWVudShlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGNvbnN0IHVzZXJJY29uID0gJCgnI3VzZXItbWVudScpO1xuICAgICQoJyN1c2VyLW1lbnUnKS5yZW1vdmVDbGFzcygnc2hvdycpO1xuICAgIHVzZXJJY29uLmNzcygnd2lkdGgnLCAnMTgwcHgnKTtcbiAgICAkKCcuY2xvc2UtaWNvbicpLnJlbW92ZSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gY2hhbmdlVHJhY2soZSkge1xuICAgIGlmICghJCh0aGlzKS5oYXNDbGFzcygnaGlnaGxpZ2h0JykpIHtcbiAgICAgICQoJy50cmFja0xpc3QnKS5yZW1vdmVDbGFzcygnaGlnaGxpZ2h0Jyk7XG4gICAgICAkKCcudHJhY2tJdGVtJykucmVtb3ZlQ2xhc3MoJ2ZpLXNvdW5kJyk7XG4gICAgICAkKHRoaXMpLmFkZENsYXNzKCdoaWdobGlnaHQnKTtcbiAgICAgICQodGhpcykuZmluZCgnLnRyYWNrSXRlbScpLmFkZENsYXNzKCdmaS1zb3VuZCcpO1xuICAgICAgY29uc3QgdHJhY2tTcmMgPSAkKHRoaXMpLmRhdGEoJ3RyYWNrLXNyYycpO1xuICAgICAgLy9jb25zdCBzdHIgPSB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWU7XG4gICAgICAvL2NvbnN0IHBhdGggPSBzdHIuc3Vic3RyKDAsIHN0ci5sYXN0SW5kZXhPZihcIi9cIikgKyAxKTtcbiAgICAgIC8vY29uc3QgdHJhY2tJZCA9ICQodGhpcykuYXR0cignaWQnKTtcbiAgICAgIG1lZGlhRWxlLnNldFNyYyh0cmFja1NyYyk7XG4gICAgICBtZWRpYUVsZS5sb2FkKCk7XG4gICAgICBtZWRpYUVsZS5wbGF5KCk7XG4gICAgICAvL2hpc3RvcnkucHVzaFN0YXRlKHRyYWNrSWQsICcnLCBwYXRoICsgdHJhY2tJZCk7XG4gICAgfVxuXG4gIH1cblxuICAvKipcbiAgICogb24gcG9wc3RhdGUgaGlnaGxpZ2h0IHRoZSBwcm9wZXIgdHJhY2tcbiAgICovXG4gIC8vICQod2luZG93KS5vbigncG9wc3RhdGUnLCBmdW5jdGlvbihlKSB7XG4gIC8vICAgY29uc3QgdHJhY2tJZCA9IGUub3JpZ2luYWxFdmVudC5zdGF0ZTtcbiAgLy8gICBpZiAodHJhY2tJZCAhPT0gbnVsbCkge1xuICAvLyAgICAgY29uc3QgdHJhY2tTcmMgPSAkKGAjJHt0cmFja0lkfWApLmRhdGEoJ3RyYWNrLXNyYycpO1xuICAvLyAgICAgJCgnLnRyYWNrTGlzdCcpLnJlbW92ZUNsYXNzKCdoaWdobGlnaHQnKTtcbiAgLy8gICAgICQoJy50cmFja0l0ZW0nKS5yZW1vdmVDbGFzcygnZmktc291bmQnKTtcbiAgLy8gICAgICQoYCMke3RyYWNrSWR9YCkuYWRkQ2xhc3MoJ2hpZ2hsaWdodCcpO1xuICAvLyAgICAgJChgIyR7dHJhY2tJZH1gKS5maW5kKCcudHJhY2tJdGVtJykuYWRkQ2xhc3MoJ2ZpLXNvdW5kJyk7XG4gIC8vXG4gIC8vICAgICBtZWRpYUVsZS5zZXRTcmModHJhY2tTcmMpO1xuICAvLyAgICAgbWVkaWFFbGUubG9hZCgpO1xuICAvLyAgICAgbWVkaWFFbGUucGxheSgpO1xuICAvLyAgIH0gZWxzZSB7XG4gIC8vICAgICBjb25zdCBzdHIgPSB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWU7XG4gIC8vICAgICBjb25zdCBpZCA9IHN0ci5zdWJzdHIoc3RyLmxhc3RJbmRleE9mKFwiL1wiKSArIDEsIHN0ci5sZW5ndGgpO1xuICAvLyAgICAgY29uc3QgdHJhY2tTcmMgPSAkKGAjJHtpZH1gKS5kYXRhKCd0cmFjay1zcmMnKTtcbiAgLy8gICAgICQoJy50cmFja0xpc3QnKS5yZW1vdmVDbGFzcygnaGlnaGxpZ2h0Jyk7XG4gIC8vICAgICAkKCcudHJhY2tJdGVtJykucmVtb3ZlQ2xhc3MoJ2ZpLXNvdW5kJyk7XG4gIC8vICAgICAkKGAjJHtpZH1gKS5hZGRDbGFzcygnaGlnaGxpZ2h0Jyk7XG4gIC8vICAgICAkKGAjJHtpZH1gKS5maW5kKCcudHJhY2tJdGVtJykuYWRkQ2xhc3MoJ2ZpLXNvdW5kJyk7XG4gIC8vXG4gIC8vICAgICBtZWRpYUVsZS5zZXRTcmModHJhY2tTcmMpO1xuICAvLyAgICAgbWVkaWFFbGUubG9hZCgpO1xuICAvLyAgICAgbWVkaWFFbGUucGxheSgpO1xuICAvLyAgIH1cbiAgLy8gfSk7XG5cbiAgLyoqXG4gICAqIFNlYXJjaFxuICAgKi9cbiAgZnVuY3Rpb24gY2FsbFNlYXJjaChlKSB7XG4gICAgaWYgKGUua2V5Q29kZSA9PT0gMTMpIHtcbiAgICAgIHNlYXJjaChlKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBzZWFyY2goZSwgc3RyLCBwb3BzdGF0ZSkge1xuICAgIGlmIChlICE9PSBudWxsKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxuXG4gICAgJCgnLmpzLXNlYXJjaFZpZXcnKS5lbXB0eSgpO1xuICAgIHZhciBzZWFyY2hTdHJpbmcgPSAoc3RyICE9PSB1bmRlZmluZWQpID8gc3RyIDogJC50cmltKCQoJyNzZWFyY2gtdGV4dCcpLnZhbCgpKTsgLyogdHJpbSBiZWdpbm5pbmcgYW5kIGVuZGluZyBzcGFjZXMgKi9cbiAgICBzZWFyY2hTdHJpbmcgPSBzZWFyY2hTdHJpbmcucmVwbGFjZSgvXFxzKy9nLCAnICcpO1xuICAgIGlmIChzZWFyY2hTdHJpbmcubGVuZ3RoID4gMCAmJiBzZWFyY2hTdHJpbmcgIT09ICcgJykge1xuICAgICAgJC5wb3N0KGAvc2VhcmNoLyR7c2VhcmNoU3RyaW5nfWApXG4gICAgICAgIC5mYWlsKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICAgICAgICAkKCcjc2VhcmNoQ29udCcpLmh0bWwoZGF0YSk7XG4gICAgICAgIH0pXG4gICAgICAgIC5kb25lKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAkKCcjc2VhcmNoQ29udCcpLmh0bWwoZGF0YSk7XG4gICAgICAgICAgJCgnI2pzLXNlYXJjaFJlc3VsdHMnKS5yZW1vdmVDbGFzcygnaGlkZScpO1xuICAgICAgICAgIGlmIChwb3BzdGF0ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjb25zdCBzdHIgPSBgL3NlYXJjaC8ke3NlYXJjaFN0cmluZ31gO1xuICAgICAgICAgICAgaGlzdG9yeS5wdXNoU3RhdGUoe1xuICAgICAgICAgICAgICBzZWFyY2g6IHNlYXJjaFN0cmluZ1xuICAgICAgICAgICAgfSwgJycsIHN0cik7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBjb25zb2xlLmxvZyh3aW5kb3cuaGlzdG9yeS5zdGF0ZSk7XG4gIGNvbnNvbGUubG9nKHdpbmRvdy5oaXN0b3J5KTtcblxuICBpZiAod2luZG93Lmhpc3Rvcnkuc3RhdGUgIT09IG51bGwpIHtcbiAgICBjb25zdCBzdGF0ZSA9IHdpbmRvdy5oaXN0b3J5LnN0YXRlO1xuICAgIGlmIChzdGF0ZS5zZWFyY2ggIT09IHVuZGVmaW5lZCAmJiBzdGF0ZS5jYXRlZ29yeSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBkaXNwbGF5U2VhcmNoQmFyKCk7XG4gICAgICBzZWFyY2gobnVsbCwgc3RhdGUuc2VhcmNoLCAnbm9Qb3BzdGF0ZScpO1xuICAgIH0gZWxzZSBpZiAoc3RhdGUuc2VhcmNoICE9PSB1bmRlZmluZWQgJiYgc3RhdGUuY2F0ZWdvcnkgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZGlzcGxheVNlYXJjaEJhcigpO1xuICAgICAgc2VlQWxsUmVzdWx0cyhudWxsLCBzdGF0ZS5zZWFyY2gsIHN0YXRlLmNhdGVnb3J5LCAnbm9Qb3BzdGF0ZScpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBvbiBwb3BzdGF0ZSBoaWdobGlnaHQgZ2V0IHRoZSBwcm9wZXIgdmlld1xuICAgKi9cblxuICAkKHdpbmRvdykub24oJ3BvcHN0YXRlJywgZnVuY3Rpb24oZSkge1xuICAgIGNvbnNvbGUubG9nKGUpO1xuICAgIGNvbnN0IHN0YXRlID0gZS5vcmlnaW5hbEV2ZW50LnN0YXRlO1xuXG4gICAgaWYgKHN0YXRlID09PSBudWxsKSB7XG4gICAgICBjb25zdCBwYXRoID0gd2luZG93LmxvY2F0aW9uLmhyZWY7XG4gICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHBhdGg7XG4gICAgfSBlbHNlIGlmIChzdGF0ZS5zZWFyY2ggIT09IHVuZGVmaW5lZCAmJiBzdGF0ZS5jYXRlZ29yeSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBkaXNwbGF5U2VhcmNoQmFyKGUpO1xuICAgICAgc2VhcmNoKGUsIHN0YXRlLnNlYXJjaCwgJ25vUG9wc3RhdGUnKTtcbiAgICB9IGVsc2UgaWYgKHN0YXRlLnNlYXJjaCAhPT0gdW5kZWZpbmVkICYmIHN0YXRlLmNhdGVnb3J5ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGRpc3BsYXlTZWFyY2hCYXIoZSk7XG4gICAgICBzZWVBbGxSZXN1bHRzKGUsIHN0YXRlLnNlYXJjaCwgc3RhdGUuY2F0ZWdvcnksICdub1BvcHN0YXRlJyk7XG4gICAgfVxuICB9KTtcblxuICBmdW5jdGlvbiBzZWVBbGxSZXN1bHRzKGUsIHNyY2hTdHIsIGNhdGVncnksIHBvcHN0YXRlKSB7XG4gICAgaWYgKGUgIT09IG51bGwpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG5cbiAgICBjb25zdCBzZWFyY2hTdHIgPSAoc3JjaFN0ciAhPT0gdW5kZWZpbmVkKSA/IHNyY2hTdHIgOiAkKCcuc2VhcmNoU3RyJykuaHRtbCgpO1xuICAgIGNvbnN0IGNhdGVnb3J5ID0gKGNhdGVncnkgIT09IHVuZGVmaW5lZCkgPyBjYXRlZ3J5IDogJCh0aGlzKS5kYXRhKCdjYXRlZ29yeScpO1xuXG4gICAgJC5wb3N0KGAvc2VhcmNoLyR7Y2F0ZWdvcnl9LyR7c2VhcmNoU3RyfWApXG4gICAgICAuZmFpbChmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICQoJyNzZWFyY2hDb250JykuaHRtbChkYXRhKTtcbiAgICAgIH0pXG4gICAgICAuZG9uZShmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICQoJyNzZWFyY2hDb250JykuaHRtbChkYXRhKTtcbiAgICAgICAgJCgnI2pzLXNlYXJjaFJlc3VsdHMnKS5yZW1vdmVDbGFzcygnaGlkZScpO1xuICAgICAgICBpZiAocG9wc3RhdGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIGNvbnN0IHN0ciA9IGAvc2VhcmNoLyR7Y2F0ZWdvcnl9LyR7c2VhcmNoU3RyfWA7XG4gICAgICAgICAgaGlzdG9yeS5wdXNoU3RhdGUoe1xuICAgICAgICAgICAgc2VhcmNoOiBzZWFyY2hTdHIsXG4gICAgICAgICAgICBjYXRlZ29yeTogY2F0ZWdvcnlcbiAgICAgICAgICB9LCAnJywgc3RyKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBsaW5rQWN0aXZlKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgJCh0aGlzKS50b2dnbGVDbGFzcygnYWN0aXZlJyk7XG4gIH1cblxuICAvKipcbiAgICogVXRpbGl0eSBmdW5jdGlvbnNcbiAgICovXG5cbiAgZnVuY3Rpb24gY2xlYXJNZXNzYWdlKCkge1xuICAgICQoJyNlcnJvcicpLmVtcHR5KCk7XG4gICAgJCgnI21zZycpLmVtcHR5KCk7XG4gICAgJCgnI2VtcHR5RmllbGRzJykuYWRkQ2xhc3MoJ2hpZGUnKTtcbiAgICAkKCcuaWNvbi1lcnJvcicpLnJlbW92ZSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gc2hvd01lc3NhZ2UobXNnVHh0LCBtc2dEaXYpIHtcbiAgICB2YXIgdWxFbGUgPSAkKCcjbXNnY29udCcpO1xuICAgIGlmICh1bEVsZS5sZW5ndGggPT09IDApIHtcbiAgICAgIHVsRWxlID0gJCgnPHVsIGlkPVxcJ21zZ2NvbnRcXCc+PC91bD4nKTtcbiAgICB9XG4gICAgdWxFbGUuYXBwZW5kKCc8bGk+JyArIG1zZ1R4dCArICc8L2xpPicpO1xuICAgICQoJyMnICsgbXNnRGl2KS5odG1sKHVsRWxlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNob3dFcnJvckNpcmNsZShjaXJjbGVJbnApIHtcbiAgICBjb25zdCBpbnBFbGUgPSAkKCcjJyArIGNpcmNsZUlucCk7XG4gICAgY29uc3Qgc3BhbkVsZSA9ICQoJzxzcGFuIGNsYXNzPVxcJ2ljb24tZXJyb3JcXCc+PGkgY2xhc3M9XFwnZmkteC1jaXJjbGVcXCc+PC9pPjwvc3Bhbj4nKTtcbiAgICBpbnBFbGUuYWZ0ZXIoc3BhbkVsZSk7XG4gIH1cblxuXG5cblxufSgpKTtcbiJdfQ==
